
R version 3.2.2 (2015-08-14) -- "Fire Safety"
Copyright (C) 2015 The R Foundation for Statistical Computing
Platform: x86_64-pc-linux-gnu (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

  Natural language support but running in an English locale

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> ### get ssr fit -- prediction horizons 1:52
> library(lubridate)
> library(ggplot2)
> library(plyr)

Attaching package: ‘plyr’

The following object is masked from ‘package:lubridate’:

    here

> library(dplyr)

Attaching package: ‘dplyr’

The following objects are masked from ‘package:plyr’:

    arrange, count, desc, failwith, id, mutate, rename, summarise,
    summarize

The following objects are masked from ‘package:lubridate’:

    intersect, setdiff, union

The following objects are masked from ‘package:stats’:

    filter, lag

The following objects are masked from ‘package:base’:

    intersect, setdiff, setequal, union

> library(reshape)

Attaching package: ‘reshape’

The following object is masked from ‘package:dplyr’:

    rename

The following objects are masked from ‘package:plyr’:

    rename, round_any

The following object is masked from ‘package:lubridate’:

    stamp

> library(ssrFlu)
> library(doMC)
Loading required package: foreach
Loading required package: iterators
Loading required package: parallel
> 
> registerDoMC(cores=3)
> 
> args <- commandArgs(trailingOnly=TRUE)
> 
> data_set <- args[1]
> prediction_horizon_limit <- as.integer(args[2])
> 
> ## load dataset
> if(identical(data_set, "ili_national")) {
+     data <- ili_national
+ } 
> if(identical(data_set, "ili_region1")) {
+     data <- ili_region1
+ } 
> if(identical(data_set, "ili_region2")) {
+     data <- ili_region2
+ } 
> if(identical(data_set, "ili_region3")) {
+     data <- ili_region3
+ } 
> if(identical(data_set, "ili_region4")) {
+     data <- ili_region4
+ } 
> if(identical(data_set, "ili_region5")) {
+     data <- ili_region5
+ } 
> if(identical(data_set, "ili_region6")) {
+     data <- ili_region6
+ } 
> if(identical(data_set, "ili_region7")) {
+     data <- ili_region7
+ } 
> if(identical(data_set, "ili_region8")) {
+     data <- ili_region8
+ } 
> if(identical(data_set, "ili_region9")) {
+     data <- ili_region9
+ } 
> if(identical(data_set, "ili_region10")) {
+     data <- ili_region10
+ } 
> 
> 
> 
> ## add log column
> data$log_total_cases <- log(data$total_cases + 1)
> 
> ## add week_start_date
> char_dates <- paste(data$year, data$week, "1")
> data$week_start_date <- as.Date(char_dates, format="%Y %W %w")
> 
> ## remove week 53s
> data <- data[-which(is.na(data$week_start_date)),]
> data <- data[262:nrow(data),]
> 
> ## add smooth log column -- or not, since it is already pretty smooth...
> sm <- loess(log_total_cases ~ as.numeric(week_start_date), data=data, span= 26 / nrow(data))
> data$smooth_log_cases <- sm$fitted
> 
> ## add time column
> data$time_ind <- seq_len(nrow(data))
> 
> ssr_control <- create_ssr_control(X_names=c("smooth_log_cases", "time_ind"),
+     y_names="total_cases",
+     time_name=NULL,
+     max_lag=list(smooth_log_cases=1,
+         time_ind=0),
+     prediction_horizons=as.integer(prediction_horizon_limit),
+     kernel_fns=list(smooth_log_cases="squared_exp_kernel",
+         time_ind="periodic_kernel"),
+     theta_est=list(smooth_log_cases="bw",
+         time_ind="bw"),
+     theta_fixed=list(time_ind=list(period=pi / 52)),
+     theta_transform_fns=list(
+         squared_exp_kernel=list(
+             bw=list(transform="log",
+                 detransform="exp")
+         ),
+         periodic_kernel=list(
+             bw=list(transform="log",
+                 detransform="exp")
+         )
+     ),
+     crossval_buffer=52,
+     loss_fn_name="mae_from_kernel_weights_and_centers",
+     loss_fn_args=list())
> 
> 
> ssr_fit <- ssr(X_names=c("smooth_log_cases", "time_ind"),
+     y_names="total_cases",
+     time_name=NULL,
+     data=data,
+     ssr_control=ssr_control)
505.0134FALSE
502.6361FALSE
389.6318FALSE
502.6273FALSE
505.0065FALSE
389.6307FALSE
502.6448FALSE
389.6329FALSE
505.0202FALSE
504.4217FALSE
398.1706FALSE
506.9148FALSE
504.4453FALSE
398.2023FALSE
506.9372FALSE
504.3982FALSE
398.1389FALSE
506.8928FALSE
499.5544FALSE
389.5832FALSE
502.6919FALSE
499.5536FALSE
389.5836FALSE
502.6892FALSE
499.5556FALSE
389.5828FALSE
502.6945FALSE
499.5272FALSE
389.5664FALSE
503.1969FALSE
499.5276FALSE
389.5667FALSE
503.2058FALSE
499.527FALSE
389.5662FALSE
503.1881FALSE
499.5287FALSE
389.5867FALSE
502.5219FALSE
499.5284FALSE
389.586FALSE
502.5222FALSE
499.5291FALSE
502.5217FALSE
389.5875FALSE
499.527FALSE
502.5219FALSE
389.5626FALSE
499.527FALSE
502.5216FALSE
389.5628FALSE
499.5271FALSE
502.5222FALSE
499.527FALSE
389.5623FALSE
502.521FALSE
499.5269FALSE
389.5605FALSE
499.527FALSE
502.5212FALSE
389.5608FALSE
499.5274FALSE
389.5603FALSE
499.5277FALSE
502.5209FALSE
499.5271FALSE
389.5676FALSE
502.5221FALSE
499.5269FALSE
502.5218FALSE
389.5668FALSE
499.5269FALSE
502.5224FALSE
389.5684FALSE
499.527FALSE
502.5209FALSE
389.559FALSE
499.5274FALSE
502.521FALSE
389.5593FALSE
499.5277FALSE
502.521FALSE
389.5587FALSE
502.5209FALSE
499.5271FALSE
389.5583FALSE
502.521FALSE
499.5269FALSE
389.5585FALSE
502.521FALSE
499.5269FALSE
389.558FALSE
499.527FALSE
502.5209FALSE
389.5611FALSE
389.5603FALSE
499.5274FALSE
502.521FALSE
389.5619FALSE
502.521FALSE
499.5277FALSE
389.5578FALSE
502.5209FALSE
499.5271FALSE
389.5581FALSE
502.521FALSE
499.5269FALSE
389.5575FALSE
502.521FALSE
389.5576FALSE
499.5269FALSE
502.5209FALSE
389.5579FALSE
499.527FALSE
502.521FALSE
389.5573FALSE
502.521FALSE
499.5271FALSE
389.5587FALSE
499.5274FALSE
502.5209FALSE
389.5579FALSE
502.521FALSE
499.5269FALSE
389.5596FALSE
502.521FALSE
499.5269FALSE
502.5209FALSE
389.5576FALSE
499.5269FALSE
502.521FALSE
389.5579FALSE
499.527FALSE
502.521FALSE
499.5269FALSE
389.5573FALSE
502.5209FALSE
499.527FALSE
389.6305FALSE
502.521FALSE
499.5269FALSE
389.6294FALSE
502.521FALSE
499.5269FALSE
389.6315FALSE
502.5209FALSE
499.5269FALSE
502.521FALSE
389.5625FALSE
499.5269FALSE
502.521FALSE
389.5617FALSE
499.5269FALSE
502.5209FALSE
389.5633FALSE
499.5269FALSE
502.521FALSE
389.5574FALSE
499.5269FALSE
$par
smooth_log_cases_lag1.bw 
               -1.772002 

$value
[1] 499.5269

$counts
function gradient 
      18       18 

$convergence
[1] 0

$message
[1] "CONVERGENCE: REL_REDUCTION_OF_F <= FACTR*EPSMCH"

502.521FALSE
389.5577FALSE
502.5209FALSE
389.5578FALSE
502.521FALSE
389.5574FALSE
502.521FALSE
502.5209FALSE
389.5577FALSE
502.521FALSE
389.5577FALSE
502.521FALSE
389.5574FALSE
502.5209FALSE
502.521FALSE
389.5577FALSE
502.521FALSE
389.5578FALSE
502.5209FALSE
389.5574FALSE
502.521FALSE
389.5577FALSE
502.521FALSE
389.5578FALSE
502.5209FALSE
502.521FALSE
389.5574FALSE
502.521FALSE
389.5577FALSE
502.5209FALSE
389.5578FALSE
502.521FALSE
502.521FALSE
389.5574FALSE
502.5209FALSE
389.5577FALSE
502.521FALSE
389.5578FALSE
502.521FALSE
502.5209FALSE
389.5574FALSE
502.521FALSE
389.5577FALSE
502.521FALSE
389.5578FALSE
502.5209FALSE
389.5574FALSE
502.521FALSE
389.5577FALSE
502.521FALSE
389.5578FALSE
502.5209FALSE
502.521FALSE
389.5574FALSE
502.521FALSE
389.5577FALSE
502.5209FALSE
389.5578FALSE
502.521FALSE
389.5574FALSE
502.521FALSE
389.5577FALSE
502.5216FALSE
389.5578FALSE
502.5219FALSE
389.5574FALSE
502.5214FALSE
502.5209FALSE
389.5577FALSE
502.521FALSE
389.5578FALSE
502.521FALSE
389.5574FALSE
502.5209FALSE
389.5577FALSE
502.521FALSE
389.5578FALSE
502.521FALSE
389.5574FALSE
502.5209FALSE
502.521FALSE
389.5577FALSE
502.521FALSE
389.5578FALSE
502.5209FALSE
389.5574FALSE
502.521FALSE
389.5577FALSE
502.521FALSE
389.5578FALSE
502.5209FALSE
389.5574FALSE
502.521FALSE
389.5577FALSE
502.521FALSE
502.5209FALSE
389.5578FALSE
502.521FALSE
389.5574FALSE
502.521FALSE
389.5577FALSE
502.5209FALSE
389.5578FALSE
502.521FALSE
389.5574FALSE
502.521FALSE
389.5577FALSE
502.5209FALSE
389.5578FALSE
502.521FALSE
502.521FALSE
389.5574FALSE
502.5209FALSE
389.5577FALSE
502.521FALSE
389.5578FALSE
502.521FALSE
389.5574FALSE
502.5209FALSE
389.5577FALSE
502.521FALSE
502.521FALSE
389.5578FALSE
502.5209FALSE
389.5574FALSE
502.521FALSE
389.5577FALSE
502.521FALSE
502.5209FALSE
389.5578FALSE
502.521FALSE
389.5574FALSE
502.521FALSE
389.5577FALSE
502.5209FALSE
502.521FALSE
389.5578FALSE
$par
time_ind_lag0.bw 
       -2.210369 

$value
[1] 389.5574

$counts
function gradient 
      38       38 

$convergence
[1] 0

$message
[1] "CONVERGENCE: REL_REDUCTION_OF_F <= FACTR*EPSMCH"

502.521FALSE
502.5209FALSE
502.521FALSE
502.521FALSE
502.5209FALSE
502.521FALSE
502.521FALSE
502.5209FALSE
502.521FALSE
502.521FALSE
502.5209FALSE
502.521FALSE
502.521FALSE
502.5209FALSE
502.521FALSE
502.521FALSE
502.5209FALSE
502.521FALSE
502.521FALSE
$par
smooth_log_cases_lag0.bw 
               -1.741244 

$value
[1] 502.5209

$counts
function gradient 
      49       49 

$convergence
[1] 52

$message
[1] "ERROR: ABNORMAL_TERMINATION_IN_LNSRCH"

422.6817FALSE
423.9455FALSE
423.902FALSE
422.641FALSE
423.9891FALSE
422.7226FALSE
423.9586FALSE
422.6904FALSE
423.9326FALSE
422.6733FALSE
396.5642FALSE
396.6496FALSE
396.5531FALSE
396.6377FALSE
396.5755FALSE
396.566FALSE
396.6616FALSE
396.5625FALSE
396.6544FALSE
393.9634FALSE
396.6449FALSE
393.9585FALSE
393.628FALSE
393.9683FALSE
393.6253FALSE
393.963FALSE
393.9639FALSE
393.6307FALSE
392.8409FALSE
393.627FALSE
392.8376FALSE
393.629FALSE
392.8442FALSE
393.2574FALSE
392.8401FALSE
392.8417FALSE
393.2546FALSE
390.6879FALSE
393.2601FALSE
390.686FALSE
393.2565FALSE
390.6899FALSE
393.2582FALSE
390.6895FALSE
391.551FALSE
390.6864FALSE
391.5481FALSE
389.81FALSE
391.554FALSE
389.8095FALSE
389.8104FALSE
391.5495FALSE
389.8105FALSE
391.5525FALSE
389.8094FALSE
390.7227FALSE
389.72FALSE
390.7227FALSE
389.7197FALSE
390.7228FALSE
389.7203FALSE
390.7312FALSE
389.7192FALSE
390.7148FALSE
389.7207FALSE
389.7843FALSE
389.6261FALSE
389.784FALSE
389.6259FALSE
389.7846FALSE
389.6262FALSE
389.7832FALSE
389.6263FALSE
389.6258FALSE
389.7854FALSE
389.5974FALSE
389.6725FALSE
389.5974FALSE
389.6724FALSE
389.5975FALSE
389.6727FALSE
389.5977FALSE
389.6718FALSE
389.5972FALSE
389.6733FALSE
389.5728FALSE
389.6754FALSE
389.5727FALSE
389.6753FALSE
389.5728FALSE
389.6755FALSE
389.5731FALSE
389.5725FALSE
389.6765FALSE
389.6014FALSE
389.6743FALSE
389.6014FALSE
389.6347FALSE
389.6014FALSE
389.6345FALSE
389.6006FALSE
389.6348FALSE
389.6022FALSE
389.5742FALSE
389.6351FALSE
389.5741FALSE
389.6342FALSE
389.5742FALSE
389.6242FALSE
389.5734FALSE
389.6241FALSE
389.575FALSE
389.6244FALSE
389.5713FALSE
389.6245FALSE
389.5712FALSE
389.624FALSE
389.5713FALSE
389.5716FALSE
389.5941FALSE
389.5719FALSE
389.594FALSE
389.5669FALSE
389.5942FALSE
389.5669FALSE
389.5944FALSE
389.5669FALSE
389.5938FALSE
389.5672FALSE
389.5676FALSE
389.6256FALSE
389.5621FALSE
389.6255FALSE
389.5621FALSE
389.6256FALSE
389.5621FALSE
389.6248FALSE
389.5624FALSE
389.5618FALSE
389.6264FALSE
389.5595FALSE
389.5869FALSE
389.5595FALSE
389.5868FALSE
389.5595FALSE
389.5869FALSE
389.5598FALSE
389.5861FALSE
389.5598FALSE
389.5877FALSE
389.5584FALSE
389.5784FALSE
389.5584FALSE
389.5784FALSE
389.5584FALSE
389.5784FALSE
389.5587FALSE
389.5787FALSE
389.5591FALSE
389.5581FALSE
389.5781FALSE
389.5581FALSE
389.5697FALSE
389.5581FALSE
389.5697FALSE
389.5584FALSE
389.5697FALSE
389.5578FALSE
389.57FALSE
389.5578FALSE
389.5694FALSE
389.5578FALSE
389.5633FALSE
389.5578FALSE
389.5633FALSE
389.558FALSE
389.5577FALSE
389.5633FALSE
389.5574FALSE
389.5625FALSE
389.5574FALSE
389.5641FALSE
389.5574FALSE
389.5606FALSE
389.5577FALSE
389.5606FALSE
389.5581FALSE
389.5606FALSE
389.5574FALSE
389.5609FALSE
389.5574FALSE
389.5603FALSE
389.5574FALSE
389.5577FALSE
389.5594FALSE
389.5579FALSE
389.5594FALSE
389.5574FALSE
389.5594FALSE
389.5574FALSE
389.5597FALSE
389.5574FALSE
389.5591FALSE
389.5577FALSE
389.5579FALSE
389.558FALSE
389.5579FALSE
389.5574FALSE
389.5574FALSE
389.5579FALSE
389.5574FALSE
389.5581FALSE
389.5577FALSE
389.5587FALSE
389.5581FALSE
389.5579FALSE
389.5574FALSE
389.5574FALSE
389.5579FALSE
389.5574FALSE
389.5579FALSE
389.5577FALSE
389.5582FALSE
389.5581FALSE
389.558FALSE
389.5574FALSE
389.5577FALSE
389.5574FALSE
389.5577FALSE
389.5574FALSE
389.5577FALSE
389.5577FALSE
389.558FALSE
389.5581FALSE
389.5574FALSE
389.5579FALSE
389.5574FALSE
389.5575FALSE
389.5574FALSE
389.5575FALSE
389.5577FALSE
389.5575FALSE
389.5581FALSE
389.5578FALSE
389.5574FALSE
389.5578FALSE
389.5574FALSE
389.5575FALSE
389.5574FALSE
389.5575FALSE
389.5577FALSE
389.5581FALSE
389.5575FALSE
389.5574FALSE
389.5577FALSE
389.5574FALSE
389.5578FALSE
389.5574FALSE
389.5574FALSE
389.5577FALSE
389.5574FALSE
389.5581FALSE
389.5574FALSE
389.5574FALSE
389.5574FALSE
389.5577FALSE
389.5574FALSE
389.5577FALSE
389.5577FALSE
389.5581FALSE
389.5574FALSE
389.5574FALSE
389.5574FALSE
389.5574FALSE
389.5574FALSE
389.5574FALSE
389.5577FALSE
389.5577FALSE
389.5581FALSE
389.5577FALSE
389.5574FALSE
389.5575FALSE
389.5574FALSE
389.5575FALSE
389.5574FALSE
389.5575FALSE
389.5577FALSE
389.5578FALSE
389.5581FALSE
389.5574FALSE
389.5574FALSE
389.5574FALSE
389.5574FALSE
389.5574FALSE
389.5574FALSE
389.5577FALSE
389.5574FALSE
389.5581FALSE
389.5577FALSE
389.5574FALSE
389.5577FALSE
389.5574FALSE
389.5574FALSE
389.5574FALSE
389.5574FALSE
389.5577FALSE
389.5574FALSE
389.5581FALSE
389.5577FALSE
389.5574FALSE
389.5574FALSE
389.5577FALSE
389.5574FALSE
389.5574FALSE
389.5577FALSE
389.5574FALSE
389.5581FALSE
389.5574FALSE
389.5574FALSE
389.5577FALSE
389.5574FALSE
389.5574FALSE
389.5577FALSE
389.5577FALSE
389.5574FALSE
389.5581FALSE
389.5574FALSE
389.5574FALSE
389.5574FALSE
389.5574FALSE
389.5574FALSE
389.5577FALSE
389.5577FALSE
389.5577FALSE
389.5581FALSE
389.5574FALSE
389.5574FALSE
389.5574FALSE
389.5574FALSE
389.5574FALSE
389.5574FALSE
389.5577FALSE
389.5577FALSE
389.5581FALSE
389.5577FALSE
389.5574FALSE
389.5574FALSE
389.5574FALSE
389.5574FALSE
389.5574FALSE
389.5577FALSE
389.5574FALSE
389.5581FALSE
$par
smooth_log_cases_lag1.bw         time_ind_lag0.bw 
                4.487321                -2.210611 

$value
[1] 389.5574

$counts
function gradient 
      38       38 

$convergence
[1] 0

$message
[1] "CONVERGENCE: REL_REDUCTION_OF_F <= FACTR*EPSMCH"

389.5577FALSE
389.5577FALSE
389.5574FALSE
389.5574FALSE
389.5574FALSE
389.5577FALSE
389.5577FALSE
389.5574FALSE
389.5574FALSE
389.5574FALSE
389.5577FALSE
389.5577FALSE
389.5574FALSE
389.5574FALSE
389.5574FALSE
389.5577FALSE
389.5577FALSE
389.5574FALSE
389.5574FALSE
389.5574FALSE
389.5577FALSE
389.5577FALSE
389.5574FALSE
389.5574FALSE
389.5574FALSE
389.5577FALSE
389.5577FALSE
389.5574FALSE
389.5574FALSE
389.5574FALSE
389.5577FALSE
389.5577FALSE
389.5574FALSE
389.5574FALSE
389.5574FALSE
389.5577FALSE
389.5577FALSE
389.5574FALSE
389.5574FALSE
389.5574FALSE
389.5577FALSE
389.5577FALSE
389.5574FALSE
389.5574FALSE
389.5574FALSE
389.5577FALSE
389.5577FALSE
389.5574FALSE
389.5574FALSE
389.5574FALSE
389.5577FALSE
389.5577FALSE
389.5574FALSE
389.5574FALSE
389.5574FALSE
389.5577FALSE
389.5577FALSE
389.5574FALSE
389.5574FALSE
389.5574FALSE
389.5577FALSE
389.5577FALSE
389.5574FALSE
389.5574FALSE
389.5574FALSE
389.5577FALSE
389.5577FALSE
$par
smooth_log_cases_lag0.bw         time_ind_lag0.bw 
                5.608694                -2.210278 

$value
[1] 389.5574

$counts
function gradient 
      46       46 

$convergence
[1] 0

$message
[1] "CONVERGENCE: REL_REDUCTION_OF_F <= FACTR*EPSMCH"

> 
> save(ssr_fit,
+     file=paste0("/home/ngr67a/2015-cdc-flu-competition/fit-competition-ssr-ph", prediction_horizon_limit, "-", data_set, ".Rdata"))
> 
> proc.time()
    user   system  elapsed 
1046.750    0.570  796.279 
