
R version 3.2.2 (2015-08-14) -- "Fire Safety"
Copyright (C) 2015 The R Foundation for Statistical Computing
Platform: x86_64-pc-linux-gnu (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

  Natural language support but running in an English locale

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> ### get ssr fit -- prediction horizons 1:52
> library(lubridate)
> library(ggplot2)
> library(plyr)

Attaching package: ‘plyr’

The following object is masked from ‘package:lubridate’:

    here

> library(dplyr)

Attaching package: ‘dplyr’

The following objects are masked from ‘package:plyr’:

    arrange, count, desc, failwith, id, mutate, rename, summarise,
    summarize

The following objects are masked from ‘package:lubridate’:

    intersect, setdiff, union

The following objects are masked from ‘package:stats’:

    filter, lag

The following objects are masked from ‘package:base’:

    intersect, setdiff, setequal, union

> library(reshape)

Attaching package: ‘reshape’

The following object is masked from ‘package:dplyr’:

    rename

The following objects are masked from ‘package:plyr’:

    rename, round_any

The following object is masked from ‘package:lubridate’:

    stamp

> library(ssrFlu)
> library(doMC)
Loading required package: foreach
Loading required package: iterators
Loading required package: parallel
> 
> registerDoMC(cores=3)
> 
> args <- commandArgs(trailingOnly=TRUE)
> 
> data_set <- args[1]
> prediction_horizon_limit <- as.integer(args[2])
> 
> ## load dataset
> if(identical(data_set, "ili_national")) {
+     data <- ili_national
+ } 
> if(identical(data_set, "ili_region1")) {
+     data <- ili_region1
+ } 
> if(identical(data_set, "ili_region2")) {
+     data <- ili_region2
+ } 
> if(identical(data_set, "ili_region3")) {
+     data <- ili_region3
+ } 
> if(identical(data_set, "ili_region4")) {
+     data <- ili_region4
+ } 
> if(identical(data_set, "ili_region5")) {
+     data <- ili_region5
+ } 
> if(identical(data_set, "ili_region6")) {
+     data <- ili_region6
+ } 
> if(identical(data_set, "ili_region7")) {
+     data <- ili_region7
+ } 
> if(identical(data_set, "ili_region8")) {
+     data <- ili_region8
+ } 
> if(identical(data_set, "ili_region9")) {
+     data <- ili_region9
+ } 
> if(identical(data_set, "ili_region10")) {
+     data <- ili_region10
+ } 
> 
> 
> 
> ## add log column
> data$log_total_cases <- log(data$total_cases + 1)
> 
> ## add week_start_date
> char_dates <- paste(data$year, data$week, "1")
> data$week_start_date <- as.Date(char_dates, format="%Y %W %w")
> 
> ## remove week 53s
> data <- data[-which(is.na(data$week_start_date)),]
> data <- data[262:nrow(data),]
> 
> ## add smooth log column -- or not, since it is already pretty smooth...
> sm <- loess(log_total_cases ~ as.numeric(week_start_date), data=data, span= 26 / nrow(data))
> data$smooth_log_cases <- sm$fitted
> 
> ## add time column
> data$time_ind <- seq_len(nrow(data))
> 
> ssr_control <- create_ssr_control(X_names=c("smooth_log_cases", "time_ind"),
+     y_names="total_cases",
+     time_name=NULL,
+     max_lag=list(smooth_log_cases=1,
+         time_ind=0),
+     prediction_horizons=as.integer(prediction_horizon_limit),
+     kernel_fns=list(smooth_log_cases="squared_exp_kernel",
+         time_ind="periodic_kernel"),
+     theta_est=list(smooth_log_cases="bw",
+         time_ind="bw"),
+     theta_fixed=list(time_ind=list(period=pi / 52)),
+     theta_transform_fns=list(
+         squared_exp_kernel=list(
+             bw=list(transform="log",
+                 detransform="exp")
+         ),
+         periodic_kernel=list(
+             bw=list(transform="log",
+                 detransform="exp")
+         )
+     ),
+     crossval_buffer=52,
+     loss_fn_name="mae_from_kernel_weights_and_centers",
+     loss_fn_args=list())
> 
> 
> ssr_fit <- ssr(X_names=c("smooth_log_cases", "time_ind"),
+     y_names="total_cases",
+     time_name=NULL,
+     data=data,
+     ssr_control=ssr_control)
452.4548FALSE
591.2949FALSE
581.6557FALSE
452.4506FALSE
591.2789FALSE
591.3109FALSE
452.4591FALSE
581.6416FALSE
580.1044FALSE
451.3587FALSE
581.6697FALSE
580.1077FALSE
574.47FALSE
451.3733FALSE
580.1011FALSE
451.3442FALSE
574.4762FALSE
580.2213FALSE
451.5162FALSE
574.4638FALSE
580.217FALSE
574.4357FALSE
580.2258FALSE
451.5121FALSE
579.9823FALSE
574.4309FALSE
451.5203FALSE
579.9822FALSE
574.4405FALSE
579.9823FALSE
574.0504FALSE
449.6802FALSE
579.9822FALSE
574.0498FALSE
449.6793FALSE
579.9822FALSE
574.051FALSE
579.9822FALSE
449.6812FALSE
579.9822FALSE
574.0422FALSE
450.2253FALSE
579.9822FALSE
574.042FALSE
450.235FALSE
579.9822FALSE
574.0423FALSE
579.9822FALSE
450.2157FALSE
574.0423FALSE
449.66FALSE
579.9822FALSE
574.0429FALSE
449.6597FALSE
579.9822FALSE
$par
smooth_log_cases_lag1.bw 
               -1.369009 

$value
[1] 579.9822

$counts
function gradient 
       7        7 

$convergence
[1] 0

$message
[1] "CONVERGENCE: REL_REDUCTION_OF_F <= FACTR*EPSMCH"

574.0417FALSE
449.6603FALSE
574.0417FALSE
449.6566FALSE
574.0416FALSE
449.6568FALSE
574.0418FALSE
449.6565FALSE
449.6556FALSE
574.0422FALSE
449.6557FALSE
574.0428FALSE
574.0416FALSE
449.6558FALSE
574.0416FALSE
449.6558FALSE
574.0416FALSE
449.656FALSE
574.0417FALSE
449.6557FALSE
574.0422FALSE
449.6556FALSE
574.0428FALSE
574.0416FALSE
449.6557FALSE
574.0416FALSE
449.6557FALSE
574.0416FALSE
449.6556FALSE
574.0417FALSE
449.6557FALSE
449.6557FALSE
574.0422FALSE
449.6556FALSE
574.0428FALSE
449.6557FALSE
574.0416FALSE
449.6557FALSE
574.0416FALSE
449.6556FALSE
574.0416FALSE
574.0416FALSE
449.6557FALSE
574.0416FALSE
449.6557FALSE
574.0417FALSE
449.6556FALSE
449.6557FALSE
574.0416FALSE
449.6557FALSE
574.0416FALSE
449.6556FALSE
574.0416FALSE
449.6557FALSE
574.0416FALSE
449.6557FALSE
574.0416FALSE
449.6556FALSE
574.0416FALSE
449.6557FALSE
574.0416FALSE
449.6557FALSE
574.0416FALSE
449.6556FALSE
574.0416FALSE
449.6557FALSE
574.0416FALSE
449.6557FALSE
574.0416FALSE
449.6556FALSE
574.0416FALSE
449.6557FALSE
574.0416FALSE
449.6557FALSE
574.0416FALSE
449.6556FALSE
574.0416FALSE
449.6557FALSE
574.0416FALSE
449.6557FALSE
574.0416FALSE
449.6556FALSE
574.0416FALSE
449.6557FALSE
574.0416FALSE
449.6557FALSE
574.0416FALSE
449.6556FALSE
574.0416FALSE
449.6557FALSE
574.0416FALSE
449.6557FALSE
574.0416FALSE
449.6556FALSE
574.0416FALSE
449.6557FALSE
574.0416FALSE
449.6557FALSE
574.0416FALSE
449.6556FALSE
574.0416FALSE
449.6557FALSE
574.0416FALSE
449.6557FALSE
449.6556FALSE
574.0416FALSE
574.0416FALSE
449.6557FALSE
574.0416FALSE
449.6557FALSE
449.6556FALSE
574.0416FALSE
574.0416FALSE
449.6557FALSE
449.6557FALSE
$par
time_ind_lag0.bw 
       -1.538857 

$value
[1] 449.6556

$counts
function gradient 
      25       25 

$convergence
[1] 0

$message
[1] "CONVERGENCE: REL_REDUCTION_OF_F <= FACTR*EPSMCH"

574.0416FALSE
574.0416FALSE
574.0416FALSE
574.0416FALSE
574.0416FALSE
574.0416FALSE
574.0416FALSE
574.0416FALSE
574.0416FALSE
574.0416FALSE
574.0416FALSE
574.0416FALSE
574.0416FALSE
574.0416FALSE
574.0416FALSE
574.0416FALSE
574.0416FALSE
574.0416FALSE
574.0416FALSE
574.0416FALSE
574.0416FALSE
574.0416FALSE
574.0416FALSE
574.0416FALSE
574.0416FALSE
574.0416FALSE
574.0416FALSE
574.0416FALSE
574.0416FALSE
574.0416FALSE
574.0416FALSE
574.0416FALSE
574.0416FALSE
574.0416FALSE
574.0416FALSE
574.0416FALSE
574.0416FALSE
574.0416FALSE
574.0416FALSE
574.0416FALSE
574.0416FALSE
574.0416FALSE
574.0416FALSE
574.0416FALSE
574.0416FALSE
574.0416FALSE
574.0416FALSE
574.0416FALSE
574.0416FALSE
574.0416FALSE
574.0416FALSE
574.0416FALSE
574.0416FALSE
574.0416FALSE
574.0416FALSE
574.0416FALSE
574.0416FALSE
574.0416FALSE
574.0416FALSE
574.0416FALSE
574.0416FALSE
574.0416FALSE
574.0416FALSE
574.0416FALSE
574.0416FALSE
574.0416FALSE
574.0416FALSE
574.0416FALSE
574.0416FALSE
574.0416FALSE
574.0416FALSE
574.0416FALSE
574.0416FALSE
574.0416FALSE
574.0416FALSE
574.0416FALSE
574.0416FALSE
574.0416FALSE
574.0416FALSE
574.0416FALSE
574.0416FALSE
574.0416FALSE
574.0416FALSE
574.0416FALSE
574.0416FALSE
574.0416FALSE
574.0416FALSE
574.0416FALSE
574.0416FALSE
574.0416FALSE
574.0416FALSE
$par
smooth_log_cases_lag0.bw 
               -1.449337 

$value
[1] 574.0416

$counts
function gradient 
      55       55 

$convergence
[1] 52

$message
[1] "ERROR: ABNORMAL_TERMINATION_IN_LNSRCH"

471.2071FALSE
473.1939FALSE
471.1982FALSE
473.1808FALSE
471.2159FALSE
473.2069FALSE
471.2158FALSE
473.2015FALSE
471.1983FALSE
473.1863FALSE
463.7126FALSE
460.0648FALSE
463.6882FALSE
460.0441FALSE
463.7369FALSE
460.0855FALSE
463.7049FALSE
460.0595FALSE
463.7203FALSE
459.1441FALSE
460.0701FALSE
459.0963FALSE
459.1441FALSE
459.144FALSE
459.0963FALSE
459.1441FALSE
459.0963FALSE
459.1441FALSE
459.0955FALSE
459.1436FALSE
459.0971FALSE
459.1437FALSE
458.5537FALSE
459.1436FALSE
458.5537FALSE
459.1436FALSE
458.5537FALSE
459.1436FALSE
458.5495FALSE
459.1418FALSE
458.558FALSE
459.1419FALSE
454.1893FALSE
459.1418FALSE
454.1893FALSE
459.1418FALSE
454.1893FALSE
459.1418FALSE
454.1867FALSE
459.1323FALSE
454.1919FALSE
451.5111FALSE
459.1323FALSE
459.1322FALSE
451.5111FALSE
459.1323FALSE
451.5111FALSE
459.1323FALSE
451.5266FALSE
459.1125FALSE
451.4956FALSE
459.1122FALSE
453.5874FALSE
459.1127FALSE
453.5874FALSE
459.1125FALSE
453.5874FALSE
459.1125FALSE
453.5847FALSE
459.1218FALSE
453.5901FALSE
459.1219FALSE
449.8654FALSE
459.1217FALSE
449.8654FALSE
459.1218FALSE
459.1218FALSE
449.8654FALSE
459.1103FALSE
449.8623FALSE
449.869FALSE
459.1103FALSE
459.1103FALSE
449.6707FALSE
459.1103FALSE
449.6707FALSE
459.1103FALSE
449.6707FALSE
459.1069FALSE
449.6703FALSE
459.1069FALSE
449.6712FALSE
459.1069FALSE
596.6003FALSE
459.1069FALSE
596.6004FALSE
459.1069FALSE
596.6001FALSE
459.1422FALSE
596.6049FALSE
459.1419FALSE
596.5956FALSE
459.1425FALSE
449.669FALSE
459.1422FALSE
449.669FALSE
459.1422FALSE
449.669FALSE
459.1069FALSE
449.6686FALSE
459.1069FALSE
449.6694FALSE
459.1069FALSE
449.6687FALSE
459.1069FALSE
449.6687FALSE
459.1069FALSE
449.6687FALSE
459.1069FALSE
449.6694FALSE
459.1069FALSE
449.668FALSE
459.107FALSE
449.6631FALSE
459.1069FALSE
449.6631FALSE
459.1069FALSE
449.6631FALSE
459.1069FALSE
449.6628FALSE
459.1069FALSE
449.6634FALSE
459.1069FALSE
449.6731FALSE
459.1069FALSE
449.6731FALSE
459.1069FALSE
449.6731FALSE
459.1069FALSE
449.6739FALSE
459.1069FALSE
449.6724FALSE
459.107FALSE
449.662FALSE
459.1069FALSE
449.662FALSE
459.1069FALSE
449.662FALSE
459.1069FALSE
459.1069FALSE
449.6622FALSE
459.107FALSE
449.6619FALSE
459.1069FALSE
449.6617FALSE
459.1069FALSE
449.6616FALSE
459.1069FALSE
459.1069FALSE
449.6617FALSE
459.107FALSE
449.6617FALSE
459.1069FALSE
449.6619FALSE
449.6617FALSE
459.1069FALSE
459.1069FALSE
449.6617FALSE
459.1069FALSE
449.6617FALSE
459.1069FALSE
449.6618FALSE
459.1069FALSE
449.6616FALSE
459.1069FALSE
449.6616FALSE
459.1069FALSE
449.6616FALSE
459.1069FALSE
449.6616FALSE
459.1069FALSE
449.6617FALSE
459.1069FALSE
449.6618FALSE
459.1069FALSE
449.6616FALSE
449.6616FALSE
459.1069FALSE
459.1069FALSE
449.6616FALSE
459.107FALSE
449.6617FALSE
449.6617FALSE
459.1069FALSE
449.6616FALSE
459.1069FALSE
449.6616FALSE
459.1069FALSE
449.6616FALSE
459.1069FALSE
449.6617FALSE
459.107FALSE
449.6618FALSE
449.6616FALSE
459.1069FALSE
449.6616FALSE
459.1069FALSE
449.6616FALSE
459.1069FALSE
449.6617FALSE
449.6618FALSE
459.1069FALSE
449.6616FALSE
459.107FALSE
449.6616FALSE
459.1069FALSE
449.6616FALSE
459.1069FALSE
449.6617FALSE
459.1069FALSE
449.6618FALSE
459.1069FALSE
449.6616FALSE
449.6616FALSE
459.107FALSE
449.6616FALSE
459.1069FALSE
449.6617FALSE
459.1069FALSE
449.6618FALSE
459.1069FALSE
449.6616FALSE
459.1069FALSE
449.6616FALSE
459.107FALSE
449.6616FALSE
459.1069FALSE
449.6617FALSE
459.1069FALSE
449.6618FALSE
459.1069FALSE
449.6616FALSE
459.1069FALSE
459.107FALSE
449.6616FALSE
459.1069FALSE
449.6616FALSE
459.1069FALSE
449.6617FALSE
459.1069FALSE
449.6618FALSE
449.6616FALSE
459.1069FALSE
449.6616FALSE
459.107FALSE
449.6616FALSE
459.1069FALSE
449.6617FALSE
459.1069FALSE
459.1069FALSE
449.6618FALSE
459.1069FALSE
449.6616FALSE
449.6616FALSE
459.107FALSE
449.6616FALSE
459.1069FALSE
449.6617FALSE
459.1069FALSE
449.6618FALSE
459.1069FALSE
449.6616FALSE
459.1069FALSE
449.6616FALSE
459.107FALSE
449.6616FALSE
459.1069FALSE
449.6617FALSE
459.1069FALSE
449.6618FALSE
459.1069FALSE
449.6616FALSE
459.1069FALSE
449.6616FALSE
459.107FALSE
449.6616FALSE
459.1069FALSE
449.6617FALSE
459.1069FALSE
449.6618FALSE
459.1069FALSE
449.6616FALSE
459.1069FALSE
449.6616FALSE
459.107FALSE
449.6616FALSE
459.1069FALSE
449.6617FALSE
459.1069FALSE
449.6618FALSE
459.1069FALSE
449.6616FALSE
459.1069FALSE
449.6616FALSE
459.107FALSE
449.6616FALSE
449.6617FALSE
459.1069FALSE
449.6618FALSE
459.1069FALSE
449.6616FALSE
459.1069FALSE
449.6616FALSE
459.1069FALSE
449.6616FALSE
459.107FALSE
449.6617FALSE
449.6618FALSE
459.1069FALSE
449.6616FALSE
459.1069FALSE
449.6616FALSE
459.1069FALSE
449.6616FALSE
459.1069FALSE
449.6617FALSE
459.107FALSE
449.6618FALSE
459.1069FALSE
449.6616FALSE
459.1069FALSE
449.6616FALSE
459.1069FALSE
449.6616FALSE
449.6617FALSE
459.1069FALSE
449.6618FALSE
459.107FALSE
449.6616FALSE
459.1069FALSE
449.6616FALSE
459.1069FALSE
449.6616FALSE
459.1069FALSE
449.6617FALSE
459.1069FALSE
449.6618FALSE
459.107FALSE
449.6616FALSE
459.1069FALSE
449.6616FALSE
459.1069FALSE
449.6616FALSE
459.1069FALSE
449.6617FALSE
459.1069FALSE
449.6618FALSE
459.107FALSE
449.6616FALSE
459.1069FALSE
449.6616FALSE
459.1069FALSE
449.6616FALSE
459.1069FALSE
459.1069FALSE
449.6617FALSE
449.6618FALSE
459.107FALSE
449.6616FALSE
459.1069FALSE
449.6616FALSE
459.1069FALSE
$par
smooth_log_cases_lag0.bw         time_ind_lag0.bw 
               0.1764395               -5.0569470 

$value
[1] 459.1069

$counts
function gradient 
      37       37 

$convergence
[1] 0

$message
[1] "CONVERGENCE: REL_REDUCTION_OF_F <= FACTR*EPSMCH"

449.6616FALSE
449.6617FALSE
449.6618FALSE
449.6665FALSE
449.6665FALSE
449.6665FALSE
449.6671FALSE
449.6662FALSE
449.6618FALSE
449.6617FALSE
449.6618FALSE
449.6619FALSE
449.6616FALSE
449.6616FALSE
449.6616FALSE
449.6616FALSE
449.6617FALSE
449.6618FALSE
449.6616FALSE
449.6616FALSE
449.6616FALSE
449.6617FALSE
449.6618FALSE
449.6616FALSE
449.6616FALSE
449.6616FALSE
449.6617FALSE
449.6618FALSE
449.6616FALSE
449.6616FALSE
449.6616FALSE
449.6617FALSE
449.6618FALSE
449.6616FALSE
449.6616FALSE
449.6616FALSE
449.6617FALSE
449.6618FALSE
449.6616FALSE
449.6616FALSE
449.6616FALSE
449.6617FALSE
449.6618FALSE
449.6616FALSE
449.6616FALSE
449.6616FALSE
449.6617FALSE
449.6618FALSE
449.6616FALSE
449.6616FALSE
449.6616FALSE
449.6617FALSE
449.6618FALSE
449.6616FALSE
449.6616FALSE
449.6616FALSE
449.6617FALSE
449.6618FALSE
449.6616FALSE
449.6616FALSE
449.6616FALSE
449.6617FALSE
449.6618FALSE
449.6616FALSE
449.6616FALSE
449.6616FALSE
449.6617FALSE
449.6618FALSE
449.6616FALSE
449.6616FALSE
449.6616FALSE
449.6617FALSE
449.6618FALSE
449.6616FALSE
449.6616FALSE
449.6616FALSE
449.6617FALSE
449.6618FALSE
449.6616FALSE
449.6616FALSE
449.6616FALSE
449.6617FALSE
449.6618FALSE
449.6616FALSE
449.6616FALSE
449.6616FALSE
449.6617FALSE
449.6618FALSE
449.6616FALSE
449.6616FALSE
449.6616FALSE
449.6617FALSE
449.6618FALSE
449.6616FALSE
449.6616FALSE
449.6616FALSE
449.6617FALSE
449.6618FALSE
449.6616FALSE
449.6616FALSE
449.6616FALSE
449.6617FALSE
449.6618FALSE
$par
smooth_log_cases_lag1.bw         time_ind_lag0.bw 
                2.085669                -1.539766 

$value
[1] 449.6616

$counts
function gradient 
      58       58 

$convergence
[1] 52

$message
[1] "ERROR: ABNORMAL_TERMINATION_IN_LNSRCH"

> 
> save(ssr_fit,
+     file=paste0("/home/ngr67a/2015-cdc-flu-competition/fit-competition-ssr-ph", prediction_horizon_limit, "-", data_set, ".Rdata"))
> 
> proc.time()
    user   system  elapsed 
1074.686    1.216 1122.071 
