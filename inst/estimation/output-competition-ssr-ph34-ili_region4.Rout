
R version 3.2.2 (2015-08-14) -- "Fire Safety"
Copyright (C) 2015 The R Foundation for Statistical Computing
Platform: x86_64-pc-linux-gnu (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

  Natural language support but running in an English locale

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> ### get ssr fit -- prediction horizons 1:52
> library(lubridate)
> library(ggplot2)
> library(plyr)

Attaching package: ‘plyr’

The following object is masked from ‘package:lubridate’:

    here

> library(dplyr)

Attaching package: ‘dplyr’

The following objects are masked from ‘package:plyr’:

    arrange, count, desc, failwith, id, mutate, rename, summarise,
    summarize

The following objects are masked from ‘package:lubridate’:

    intersect, setdiff, union

The following objects are masked from ‘package:stats’:

    filter, lag

The following objects are masked from ‘package:base’:

    intersect, setdiff, setequal, union

> library(reshape)

Attaching package: ‘reshape’

The following object is masked from ‘package:dplyr’:

    rename

The following objects are masked from ‘package:plyr’:

    rename, round_any

The following object is masked from ‘package:lubridate’:

    stamp

> library(ssrFlu)
> library(doMC)
Loading required package: foreach
Loading required package: iterators
Loading required package: parallel
> 
> registerDoMC(cores=3)
> 
> args <- commandArgs(trailingOnly=TRUE)
> 
> data_set <- args[1]
> prediction_horizon_limit <- as.integer(args[2])
> 
> ## load dataset
> if(identical(data_set, "ili_national")) {
+     data <- ili_national
+ } 
> if(identical(data_set, "ili_region1")) {
+     data <- ili_region1
+ } 
> if(identical(data_set, "ili_region2")) {
+     data <- ili_region2
+ } 
> if(identical(data_set, "ili_region3")) {
+     data <- ili_region3
+ } 
> if(identical(data_set, "ili_region4")) {
+     data <- ili_region4
+ } 
> if(identical(data_set, "ili_region5")) {
+     data <- ili_region5
+ } 
> if(identical(data_set, "ili_region6")) {
+     data <- ili_region6
+ } 
> if(identical(data_set, "ili_region7")) {
+     data <- ili_region7
+ } 
> if(identical(data_set, "ili_region8")) {
+     data <- ili_region8
+ } 
> if(identical(data_set, "ili_region9")) {
+     data <- ili_region9
+ } 
> if(identical(data_set, "ili_region10")) {
+     data <- ili_region10
+ } 
> 
> 
> 
> ## add log column
> data$log_total_cases <- log(data$total_cases + 1)
> 
> ## add week_start_date
> char_dates <- paste(data$year, data$week, "1")
> data$week_start_date <- as.Date(char_dates, format="%Y %W %w")
> 
> ## remove week 53s
> data <- data[-which(is.na(data$week_start_date)),]
> data <- data[262:nrow(data),]
> 
> ## add smooth log column -- or not, since it is already pretty smooth...
> sm <- loess(log_total_cases ~ as.numeric(week_start_date), data=data, span= 26 / nrow(data))
> data$smooth_log_cases <- sm$fitted
> 
> ## add time column
> data$time_ind <- seq_len(nrow(data))
> 
> ssr_control <- create_ssr_control(X_names=c("smooth_log_cases", "time_ind"),
+     y_names="total_cases",
+     time_name=NULL,
+     max_lag=list(smooth_log_cases=1,
+         time_ind=0),
+     prediction_horizons=as.integer(prediction_horizon_limit),
+     kernel_fns=list(smooth_log_cases="squared_exp_kernel",
+         time_ind="periodic_kernel"),
+     theta_est=list(smooth_log_cases="bw",
+         time_ind="bw"),
+     theta_fixed=list(time_ind=list(period=pi / 52)),
+     theta_transform_fns=list(
+         squared_exp_kernel=list(
+             bw=list(transform="log",
+                 detransform="exp")
+         ),
+         periodic_kernel=list(
+             bw=list(transform="log",
+                 detransform="exp")
+         )
+     ),
+     crossval_buffer=52,
+     loss_fn_name="mae_from_kernel_weights_and_centers",
+     loss_fn_args=list())
> 
> 
> ssr_fit <- ssr(X_names=c("smooth_log_cases", "time_ind"),
+     y_names="total_cases",
+     time_name=NULL,
+     data=data,
+     ssr_control=ssr_control)
544.964FALSE
551.5013FALSE
387.6108FALSE
544.9577FALSE
387.6092FALSE
551.4967FALSE
544.9709FALSE
551.5058FALSE
387.6125FALSE
545.6814FALSE
552.7052FALSE
395.6043FALSE
545.6884FALSE
552.7098FALSE
545.6744FALSE
552.7006FALSE
395.634FALSE
543.8851FALSE
550.9517FALSE
543.8853FALSE
395.5746FALSE
550.9519FALSE
543.8849FALSE
387.4621FALSE
550.9514FALSE
543.8821FALSE
550.9464FALSE
387.4626FALSE
543.8823FALSE
550.9468FALSE
543.8818FALSE
387.4616FALSE
550.9461FALSE
543.8587FALSE
550.9488FALSE
387.4677FALSE
543.8593FALSE
550.9489FALSE
387.4676FALSE
543.8581FALSE
550.9488FALSE
387.4679FALSE
544.1053FALSE
550.9574FALSE
387.46FALSE
544.1026FALSE
550.9564FALSE
544.1084FALSE
387.4601FALSE
550.9585FALSE
543.8506FALSE
550.9488FALSE
387.46FALSE
543.8502FALSE
550.9488FALSE
543.8511FALSE
387.4599FALSE
550.9487FALSE
543.8529FALSE
550.9487FALSE
387.46FALSE
550.9487FALSE
543.8532FALSE
387.4602FALSE
550.9486FALSE
543.8525FALSE
550.9508FALSE
387.46FALSE
550.9502FALSE
543.8499FALSE
387.46FALSE
550.9514FALSE
543.8501FALSE
550.9486FALSE
387.46FALSE
543.8497FALSE
550.9487FALSE
387.46FALSE
543.8499FALSE
550.9485FALSE
387.46FALSE
543.8501FALSE
550.9486FALSE
543.8497FALSE
387.46FALSE
550.9486FALSE
550.9485FALSE
559.6454FALSE
387.46FALSE
550.9488FALSE
387.46FALSE
550.9487FALSE
559.6388FALSE
550.9492FALSE
559.652FALSE
387.46FALSE
550.9485FALSE
550.9486FALSE
543.8526FALSE
387.46FALSE
550.9486FALSE
387.46FALSE
543.8521FALSE
550.9486FALSE
387.46FALSE
550.9487FALSE
543.853FALSE
550.9486FALSE
387.46FALSE
543.8498FALSE
550.9485FALSE
387.46FALSE
550.9486FALSE
543.85FALSE
387.46FALSE
550.9486FALSE
543.8498FALSE
387.46FALSE
550.9485FALSE
550.9486FALSE
387.46FALSE
543.8497FALSE
550.9486FALSE
387.46FALSE
543.8499FALSE
550.9485FALSE
550.9486FALSE
387.46FALSE
543.85FALSE
550.9486FALSE
543.8497FALSE
387.46FALSE
550.9485FALSE
550.9486FALSE
387.46FALSE
543.8499FALSE
550.9486FALSE
387.46FALSE
550.9485FALSE
543.8499FALSE
387.46FALSE
550.9486FALSE
543.8497FALSE
387.46FALSE
550.9486FALSE
543.8499FALSE
550.9485FALSE
387.46FALSE
543.8499FALSE
550.9486FALSE
387.46FALSE
543.8497FALSE
387.46FALSE
550.9486FALSE
543.8499FALSE
387.46FALSE
550.9485FALSE
543.8499FALSE
387.46FALSE
550.9486FALSE
543.8497FALSE
550.9486FALSE
387.46FALSE
543.8499FALSE
550.9485FALSE
387.46FALSE
543.8499FALSE
550.9486FALSE
543.8497FALSE
387.46FALSE
550.9486FALSE
543.8499FALSE
387.46FALSE
550.9485FALSE
543.8499FALSE
387.46FALSE
550.9486FALSE
543.8497FALSE
387.46FALSE
550.9486FALSE
543.8499FALSE
387.46FALSE
550.9485FALSE
543.8499FALSE
550.9486FALSE
387.46FALSE
543.8497FALSE
550.9486FALSE
387.46FALSE
543.8499FALSE
550.9485FALSE
387.46FALSE
543.8499FALSE
550.9486FALSE
387.46FALSE
543.8497FALSE
550.9486FALSE
387.46FALSE
550.9485FALSE
543.8499FALSE
387.46FALSE
550.9486FALSE
543.8499FALSE
387.46FALSE
550.9486FALSE
543.8497FALSE
550.9485FALSE
387.46FALSE
543.8499FALSE
550.9486FALSE
387.46FALSE
543.8499FALSE
550.9486FALSE
387.46FALSE
543.8497FALSE
550.9485FALSE
387.46FALSE
543.8499FALSE
550.9486FALSE
387.46FALSE
543.8499FALSE
550.9486FALSE
387.46FALSE
543.8497FALSE
550.9485FALSE
543.8499FALSE
387.46FALSE
550.9486FALSE
543.8499FALSE
387.46FALSE
550.9486FALSE
543.8497FALSE
550.9485FALSE
387.46FALSE
550.9486FALSE
543.8499FALSE
387.46FALSE
550.9486FALSE
387.46FALSE
$par
time_ind_lag0.bw 
       -2.127581 

$value
[1] 387.46

$counts
function gradient 
      24       24 

$convergence
[1] 0

$message
[1] "CONVERGENCE: REL_REDUCTION_OF_F <= FACTR*EPSMCH"

543.8499FALSE
550.9485FALSE
543.8497FALSE
550.9486FALSE
543.8499FALSE
550.9486FALSE
543.8499FALSE
550.9485FALSE
543.8497FALSE
550.9486FALSE
543.8499FALSE
550.9486FALSE
543.8499FALSE
550.9485FALSE
543.8497FALSE
550.9486FALSE
543.8499FALSE
550.9486FALSE
543.8499FALSE
550.9485FALSE
543.8497FALSE
550.9486FALSE
550.9486FALSE
543.8499FALSE
550.9485FALSE
543.8499FALSE
550.9486FALSE
543.8497FALSE
550.9486FALSE
543.8499FALSE
550.949FALSE
543.8499FALSE
550.9491FALSE
543.8497FALSE
550.949FALSE
543.8499FALSE
550.9485FALSE
543.8499FALSE
550.9486FALSE
543.8497FALSE
550.9486FALSE
543.8499FALSE
550.9485FALSE
543.8499FALSE
550.9486FALSE
550.9486FALSE
543.8497FALSE
550.9485FALSE
543.8499FALSE
550.9486FALSE
543.8499FALSE
550.9486FALSE
543.8497FALSE
550.9485FALSE
543.8499FALSE
550.9486FALSE
543.8499FALSE
550.9486FALSE
543.8497FALSE
550.9485FALSE
543.8499FALSE
550.9486FALSE
550.9486FALSE
543.8499FALSE
550.9485FALSE
543.8497FALSE
550.9486FALSE
550.9486FALSE
543.8499FALSE
550.9485FALSE
543.8499FALSE
550.9486FALSE
543.8497FALSE
550.9486FALSE
543.8499FALSE
550.9485FALSE
550.9486FALSE
543.8499FALSE
550.9486FALSE
543.8497FALSE
550.9485FALSE
543.8499FALSE
550.9486FALSE
543.8499FALSE
550.9486FALSE
543.8497FALSE
550.9485FALSE
543.8499FALSE
550.9486FALSE
543.8499FALSE
550.9486FALSE
543.8497FALSE
550.9485FALSE
543.8499FALSE
550.9486FALSE
543.8499FALSE
550.9486FALSE
550.9485FALSE
543.8497FALSE
550.9486FALSE
543.8499FALSE
550.9486FALSE
543.8499FALSE
550.9485FALSE
550.9486FALSE
543.8497FALSE
550.9486FALSE
543.8499FALSE
550.9485FALSE
543.8499FALSE
550.9486FALSE
543.8497FALSE
550.9486FALSE
543.8499FALSE
550.9485FALSE
543.8499FALSE
550.9486FALSE
543.8497FALSE
550.9486FALSE
$par
smooth_log_cases_lag1.bw 
                -2.06856 

$value
[1] 550.9485

$counts
function gradient 
      51       51 

$convergence
[1] 0

$message
[1] "CONVERGENCE: REL_REDUCTION_OF_F <= FACTR*EPSMCH"

543.8499FALSE
543.8499FALSE
543.8497FALSE
543.8499FALSE
543.8499FALSE
543.8497FALSE
543.8499FALSE
543.8499FALSE
543.8497FALSE
543.8499FALSE
543.8499FALSE
543.8497FALSE
543.8499FALSE
543.8499FALSE
543.8497FALSE
543.8499FALSE
543.8499FALSE
543.8497FALSE
543.8499FALSE
543.8499FALSE
543.8497FALSE
543.8499FALSE
543.8499FALSE
543.8497FALSE
543.8499FALSE
543.8499FALSE
543.8497FALSE
543.8499FALSE
543.8499FALSE
543.8497FALSE
543.8499FALSE
543.8499FALSE
$par
smooth_log_cases_lag0.bw 
               -1.966082 

$value
[1] 543.8497

$counts
function gradient 
      55       55 

$convergence
[1] 52

$message
[1] "ERROR: ABNORMAL_TERMINATION_IN_LNSRCH"

409.2491FALSE
409.9582FALSE
409.238FALSE
409.9539FALSE
409.2601FALSE
409.9624FALSE
409.2567FALSE
409.2414FALSE
409.9669FALSE
393.655FALSE
409.9494FALSE
393.6405FALSE
400.709FALSE
393.6695FALSE
400.6939FALSE
400.724FALSE
393.6549FALSE
400.708FALSE
393.6551FALSE
400.7099FALSE
394.2425FALSE
394.2425FALSE
394.1027FALSE
394.1029FALSE
394.2425FALSE
394.1024FALSE
394.2425FALSE
394.1027FALSE
394.2425FALSE
394.1027FALSE
394.2416FALSE
394.0948FALSE
394.2416FALSE
394.095FALSE
394.2416FALSE
394.0945FALSE
394.2416FALSE
394.0948FALSE
394.2416FALSE
394.0948FALSE
391.7764FALSE
394.0591FALSE
391.7768FALSE
394.0593FALSE
391.7761FALSE
394.0588FALSE
391.7703FALSE
394.0591FALSE
391.7825FALSE
394.0591FALSE
389.9278FALSE
393.9032FALSE
389.928FALSE
393.9033FALSE
389.9275FALSE
393.9031FALSE
389.9236FALSE
393.9032FALSE
389.9319FALSE
388.4276FALSE
393.9032FALSE
388.4255FALSE
394.3337FALSE
388.4297FALSE
394.3305FALSE
388.4273FALSE
394.3369FALSE
388.4279FALSE
394.3337FALSE
388.3207FALSE
394.3337FALSE
388.32FALSE
393.8986FALSE
388.3214FALSE
393.8987FALSE
388.319FALSE
393.8985FALSE
388.3224FALSE
393.8986FALSE
393.8986FALSE
388.1292FALSE
393.8947FALSE
388.1285FALSE
393.8948FALSE
393.8946FALSE
388.1299FALSE
393.8947FALSE
388.1282FALSE
393.8947FALSE
388.1301FALSE
393.9999FALSE
387.7841FALSE
393.9985FALSE
387.7835FALSE
394.0013FALSE
387.7848FALSE
393.9999FALSE
387.7836FALSE
393.9999FALSE
387.7847FALSE
393.8933FALSE
393.8934FALSE
391.1504FALSE
393.8932FALSE
391.1502FALSE
393.8933FALSE
391.1506FALSE
393.8933FALSE
393.8921FALSE
391.1643FALSE
393.8922FALSE
391.1366FALSE
393.8922FALSE
387.6476FALSE
393.8921FALSE
387.6471FALSE
393.8921FALSE
387.6481FALSE
393.8926FALSE
387.6483FALSE
393.8924FALSE
387.6469FALSE
393.8927FALSE
387.5871FALSE
393.8926FALSE
387.5868FALSE
393.8926FALSE
387.5874FALSE
393.8921FALSE
387.5875FALSE
393.8922FALSE
393.8922FALSE
387.5866FALSE
393.8921FALSE
387.5456FALSE
393.8921FALSE
387.5454FALSE
393.8921FALSE
387.5457FALSE
393.8922FALSE
387.5454FALSE
393.8922FALSE
387.5457FALSE
393.8921FALSE
387.4941FALSE
393.8921FALSE
$par
smooth_log_cases_lag0.bw         time_ind_lag0.bw 
              -0.5052256               -4.8886321 

$value
[1] 393.8921

$counts
function gradient 
      15       15 

$convergence
[1] 0

$message
[1] "CONVERGENCE: REL_REDUCTION_OF_F <= FACTR*EPSMCH"

387.494FALSE
387.4942FALSE
387.4948FALSE
387.4934FALSE
387.4804FALSE
387.4803FALSE
387.4804FALSE
387.4802FALSE
387.4806FALSE
387.4704FALSE
387.4704FALSE
387.4704FALSE
387.4705FALSE
387.4702FALSE
387.4653FALSE
387.4653FALSE
387.4653FALSE
387.4654FALSE
387.4652FALSE
387.4627FALSE
387.4627FALSE
387.4627FALSE
387.4626FALSE
387.4629FALSE
387.4612FALSE
387.4612FALSE
387.4612FALSE
387.4613FALSE
387.4611FALSE
387.4609FALSE
387.4609FALSE
387.4609FALSE
387.461FALSE
387.4608FALSE
387.6304FALSE
387.6304FALSE
387.6304FALSE
387.6288FALSE
387.632FALSE
387.4613FALSE
387.4613FALSE
387.4613FALSE
387.461FALSE
387.4616FALSE
387.4607FALSE
387.4607FALSE
387.4607FALSE
387.4608FALSE
387.4606FALSE
387.4607FALSE
387.4607FALSE
387.4607FALSE
387.4607FALSE
387.4606FALSE
387.4606FALSE
387.4606FALSE
387.4606FALSE
387.4607FALSE
387.4607FALSE
387.4603FALSE
387.4603FALSE
387.4603FALSE
387.4603FALSE
387.4606FALSE
387.4604FALSE
387.4604FALSE
387.4604FALSE
387.4605FALSE
387.4603FALSE
387.4602FALSE
387.4602FALSE
387.4602FALSE
387.4602FALSE
387.4601FALSE
387.4601FALSE
387.4601FALSE
387.4601FALSE
387.4602FALSE
387.46FALSE
387.4601FALSE
387.4601FALSE
387.4601FALSE
387.46FALSE
387.4603FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.4601FALSE
387.4601FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.4601FALSE
387.4601FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.4601FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.4601FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.4601FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.4601FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.4601FALSE
387.4601FALSE
387.4601FALSE
387.4602FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
387.46FALSE
$par
smooth_log_cases_lag1.bw         time_ind_lag0.bw 
                6.020087                -2.127590 

$value
[1] 387.46

$counts
function gradient 
      75       75 

$convergence
[1] 0

$message
[1] "CONVERGENCE: REL_REDUCTION_OF_F <= FACTR*EPSMCH"

> 
> save(ssr_fit,
+     file=paste0("/home/ngr67a/2015-cdc-flu-competition/fit-competition-ssr-ph", prediction_horizon_limit, "-", data_set, ".Rdata"))
> 
> proc.time()
    user   system  elapsed 
1094.037    0.925 1311.832 
