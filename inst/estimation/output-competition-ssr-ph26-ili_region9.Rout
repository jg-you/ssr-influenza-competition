
R version 3.2.2 (2015-08-14) -- "Fire Safety"
Copyright (C) 2015 The R Foundation for Statistical Computing
Platform: x86_64-pc-linux-gnu (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

  Natural language support but running in an English locale

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> ### get ssr fit -- prediction horizons 1:52
> library(lubridate)
> library(ggplot2)
> library(plyr)

Attaching package: ‘plyr’

The following object is masked from ‘package:lubridate’:

    here

> library(dplyr)

Attaching package: ‘dplyr’

The following objects are masked from ‘package:plyr’:

    arrange, count, desc, failwith, id, mutate, rename, summarise,
    summarize

The following objects are masked from ‘package:lubridate’:

    intersect, setdiff, union

The following objects are masked from ‘package:stats’:

    filter, lag

The following objects are masked from ‘package:base’:

    intersect, setdiff, setequal, union

> library(reshape)

Attaching package: ‘reshape’

The following object is masked from ‘package:dplyr’:

    rename

The following objects are masked from ‘package:plyr’:

    rename, round_any

The following object is masked from ‘package:lubridate’:

    stamp

> library(ssrFlu)
> library(doMC)
Loading required package: foreach
Loading required package: iterators
Loading required package: parallel
> 
> registerDoMC(cores=3)
> 
> args <- commandArgs(trailingOnly=TRUE)
> 
> data_set <- args[1]
> prediction_horizon_limit <- as.integer(args[2])
> 
> ## load dataset
> if(identical(data_set, "ili_national")) {
+     data <- ili_national
+ } 
> if(identical(data_set, "ili_region1")) {
+     data <- ili_region1
+ } 
> if(identical(data_set, "ili_region2")) {
+     data <- ili_region2
+ } 
> if(identical(data_set, "ili_region3")) {
+     data <- ili_region3
+ } 
> if(identical(data_set, "ili_region4")) {
+     data <- ili_region4
+ } 
> if(identical(data_set, "ili_region5")) {
+     data <- ili_region5
+ } 
> if(identical(data_set, "ili_region6")) {
+     data <- ili_region6
+ } 
> if(identical(data_set, "ili_region7")) {
+     data <- ili_region7
+ } 
> if(identical(data_set, "ili_region8")) {
+     data <- ili_region8
+ } 
> if(identical(data_set, "ili_region9")) {
+     data <- ili_region9
+ } 
> if(identical(data_set, "ili_region10")) {
+     data <- ili_region10
+ } 
> 
> 
> 
> ## add log column
> data$log_total_cases <- log(data$total_cases + 1)
> 
> ## add week_start_date
> char_dates <- paste(data$year, data$week, "1")
> data$week_start_date <- as.Date(char_dates, format="%Y %W %w")
> 
> ## remove week 53s
> data <- data[-which(is.na(data$week_start_date)),]
> data <- data[262:nrow(data),]
> 
> ## add smooth log column -- or not, since it is already pretty smooth...
> sm <- loess(log_total_cases ~ as.numeric(week_start_date), data=data, span= 26 / nrow(data))
> data$smooth_log_cases <- sm$fitted
> 
> ## add time column
> data$time_ind <- seq_len(nrow(data))
> 
> ssr_control <- create_ssr_control(X_names=c("smooth_log_cases", "time_ind"),
+     y_names="total_cases",
+     time_name=NULL,
+     max_lag=list(smooth_log_cases=1,
+         time_ind=0),
+     prediction_horizons=as.integer(prediction_horizon_limit),
+     kernel_fns=list(smooth_log_cases="squared_exp_kernel",
+         time_ind="periodic_kernel"),
+     theta_est=list(smooth_log_cases="bw",
+         time_ind="bw"),
+     theta_fixed=list(time_ind=list(period=pi / 52)),
+     theta_transform_fns=list(
+         squared_exp_kernel=list(
+             bw=list(transform="log",
+                 detransform="exp")
+         ),
+         periodic_kernel=list(
+             bw=list(transform="log",
+                 detransform="exp")
+         )
+     ),
+     crossval_buffer=52,
+     loss_fn_name="mae_from_kernel_weights_and_centers",
+     loss_fn_args=list())
> 
> 
> ssr_fit <- ssr(X_names=c("smooth_log_cases", "time_ind"),
+     y_names="total_cases",
+     time_name=NULL,
+     data=data,
+     ssr_control=ssr_control)
616.4266FALSE
462.2364FALSE
617.4816FALSE
616.3989FALSE
462.2356FALSE
617.4473FALSE
616.4543FALSE
462.2372FALSE
617.5159FALSE
467.6005FALSE
606.5472FALSE
606.9565FALSE
467.6349FALSE
606.5651FALSE
606.9759FALSE
467.5661FALSE
606.5294FALSE
606.9371FALSE
461.8154FALSE
602.3175FALSE
602.7946FALSE
461.8153FALSE
602.314FALSE
602.7874FALSE
461.8155FALSE
602.321FALSE
602.8017FALSE
461.8116FALSE
602.4081FALSE
602.6216FALSE
602.4135FALSE
461.8113FALSE
602.6246FALSE
602.4028FALSE
461.8119FALSE
602.6186FALSE
602.2813FALSE
461.7851FALSE
602.5494FALSE
602.2822FALSE
461.7855FALSE
602.551FALSE
602.281FALSE
461.7847FALSE
602.5478FALSE
602.2807FALSE
461.7993FALSE
602.5735FALSE
602.281FALSE
461.7988FALSE
602.571FALSE
602.2805FALSE
461.7998FALSE
602.576FALSE
602.2808FALSE
602.5421FALSE
461.787FALSE
602.2806FALSE
602.5423FALSE
461.7868FALSE
602.2824FALSE
602.542FALSE
461.7872FALSE
602.2806FALSE
602.542FALSE
602.2808FALSE
461.7851FALSE
602.5421FALSE
602.2812FALSE
461.7855FALSE
602.542FALSE
602.2806FALSE
602.5419FALSE
602.2809FALSE
461.7847FALSE
602.5419FALSE
602.2807FALSE
461.8134FALSE
602.5419FALSE
602.2806FALSE
461.8132FALSE
602.5419FALSE
602.2808FALSE
461.8136FALSE
602.5419FALSE
602.2811FALSE
602.5419FALSE
$par
smooth_log_cases_lag1.bw 
               -1.632509 

$value
[1] 602.5419

$counts
function gradient 
      10       10 

$convergence
[1] 0

$message
[1] "CONVERGENCE: REL_REDUCTION_OF_F <= FACTR*EPSMCH"

461.7878FALSE
602.2806FALSE
602.2808FALSE
461.7876FALSE
602.2812FALSE
461.7879FALSE
602.2806FALSE
461.7852FALSE
602.2808FALSE
461.7849FALSE
461.7855FALSE
602.2812FALSE
461.7847FALSE
602.2806FALSE
461.7851FALSE
602.2808FALSE
461.785FALSE
461.7848FALSE
602.2812FALSE
461.785FALSE
461.785FALSE
602.2806FALSE
461.7847FALSE
461.7851FALSE
602.2808FALSE
461.785FALSE
461.7847FALSE
602.2812FALSE
461.7851FALSE
602.2806FALSE
461.785FALSE
461.7847FALSE
602.2808FALSE
461.7851FALSE
461.785FALSE
602.2812FALSE
461.7847FALSE
461.7851FALSE
602.2806FALSE
461.785FALSE
461.7847FALSE
602.2808FALSE
461.7851FALSE
602.2812FALSE
461.785FALSE
461.7847FALSE
602.2806FALSE
461.7851FALSE
602.2808FALSE
461.785FALSE
602.2812FALSE
461.7847FALSE
461.7851FALSE
602.2806FALSE
461.785FALSE
461.7847FALSE
602.2808FALSE
461.7851FALSE
461.785FALSE
602.2812FALSE
461.7847FALSE
602.2806FALSE
461.7851FALSE
602.2808FALSE
461.785FALSE
602.2812FALSE
461.7847FALSE
602.2806FALSE
461.7851FALSE
602.2808FALSE
461.785FALSE
602.2812FALSE
461.7847FALSE
602.2806FALSE
461.7851FALSE
602.2808FALSE
461.785FALSE
602.2812FALSE
461.7847FALSE
602.2806FALSE
461.7851FALSE
602.2808FALSE
461.785FALSE
602.2812FALSE
461.7847FALSE
602.2806FALSE
461.7851FALSE
602.2808FALSE
461.785FALSE
602.2812FALSE
461.7847FALSE
602.2806FALSE
461.7851FALSE
602.2808FALSE
461.785FALSE
602.2812FALSE
461.7847FALSE
602.2806FALSE
461.7851FALSE
602.2808FALSE
461.785FALSE
602.2812FALSE
602.2806FALSE
461.7847FALSE
602.2808FALSE
461.7851FALSE
602.2812FALSE
461.785FALSE
602.2806FALSE
461.7847FALSE
602.2808FALSE
461.7851FALSE
602.2812FALSE
461.785FALSE
602.2806FALSE
461.7847FALSE
602.2808FALSE
461.7851FALSE
602.2812FALSE
603.8406FALSE
461.785FALSE
603.8564FALSE
461.7847FALSE
603.8248FALSE
461.7851FALSE
602.281FALSE
461.785FALSE
$par
time_ind_lag0.bw 
       -1.904106 

$value
[1] 461.7847

$counts
function gradient 
      32       32 

$convergence
[1] 0

$message
[1] "CONVERGENCE: REL_REDUCTION_OF_F <= FACTR*EPSMCH"

602.2812FALSE
602.2807FALSE
602.2806FALSE
602.2808FALSE
602.2808FALSE
602.2806FALSE
602.2808FALSE
602.2811FALSE
602.2806FALSE
602.2808FALSE
602.2812FALSE
602.2806FALSE
602.2808FALSE
602.2812FALSE
602.2806FALSE
602.2808FALSE
602.2812FALSE
602.2806FALSE
602.2808FALSE
602.2812FALSE
602.2806FALSE
602.2808FALSE
602.2812FALSE
602.2806FALSE
602.2808FALSE
602.2812FALSE
602.2806FALSE
602.2808FALSE
602.2812FALSE
602.2806FALSE
602.2808FALSE
602.2812FALSE
602.2806FALSE
602.2808FALSE
602.2812FALSE
602.2806FALSE
602.2808FALSE
602.2812FALSE
602.2806FALSE
602.2808FALSE
602.2812FALSE
602.2806FALSE
602.2808FALSE
602.2812FALSE
602.2806FALSE
602.2808FALSE
602.2812FALSE
602.2806FALSE
602.2808FALSE
602.2812FALSE
602.2806FALSE
602.2808FALSE
602.2812FALSE
602.2806FALSE
602.2808FALSE
602.2812FALSE
$par
smooth_log_cases_lag0.bw 
               -1.650588 

$value
[1] 602.2806

$counts
function gradient 
      48       48 

$convergence
[1] 0

$message
[1] "CONVERGENCE: REL_REDUCTION_OF_F <= FACTR*EPSMCH"

498.0182FALSE
503.4247FALSE
498.0016FALSE
503.3999FALSE
498.0346FALSE
503.4494FALSE
498.0356FALSE
503.4425FALSE
498.0007FALSE
476.1001FALSE
503.4068FALSE
476.0705FALSE
475.777FALSE
476.1295FALSE
475.7551FALSE
476.1002FALSE
475.799FALSE
476.0999FALSE
475.7788FALSE
468.4367FALSE
475.7753FALSE
468.4367FALSE
463.2662FALSE
468.4367FALSE
463.2662FALSE
463.2663FALSE
468.4367FALSE
463.2641FALSE
468.4367FALSE
463.2684FALSE
463.0593FALSE
468.4367FALSE
463.0592FALSE
463.0593FALSE
468.4367FALSE
463.0577FALSE
463.0608FALSE
468.4367FALSE
462.6172FALSE
468.4367FALSE
462.6172FALSE
462.6173FALSE
468.4367FALSE
462.616FALSE
468.4367FALSE
468.4367FALSE
462.6185FALSE
468.4367FALSE
468.4367FALSE
464.1777FALSE
468.4367FALSE
468.4367FALSE
464.1772FALSE
468.4367FALSE
468.4367FALSE
464.1782FALSE
468.4367FALSE
468.4367FALSE
464.1914FALSE
468.4367FALSE
468.4367FALSE
464.1641FALSE
468.4367FALSE
468.4367FALSE
462.1472FALSE
468.4367FALSE
468.4367FALSE
462.1471FALSE
468.4367FALSE
468.4367FALSE
462.1473FALSE
468.4367FALSE
468.4367FALSE
462.1453FALSE
468.4367FALSE
468.4367FALSE
462.1491FALSE
468.4367FALSE
461.8942FALSE
468.4367FALSE
468.4367FALSE
461.8939FALSE
468.4367FALSE
468.4367FALSE
461.8944FALSE
468.4367FALSE
461.8946FALSE
468.4367FALSE
468.4367FALSE
461.8937FALSE
468.4367FALSE
462.0217FALSE
468.4367FALSE
462.0215FALSE
468.4367FALSE
462.0218FALSE
462.0199FALSE
468.4367FALSE
462.0238FALSE
468.4367FALSE
461.891FALSE
468.4367FALSE
461.8908FALSE
468.4367FALSE
461.8912FALSE
468.4367FALSE
468.4367FALSE
461.8906FALSE
461.8914FALSE
468.4367FALSE
461.8821FALSE
468.4367FALSE
461.8819FALSE
468.4367FALSE
461.8823FALSE
468.4367FALSE
461.8822FALSE
468.4367FALSE
461.882FALSE
468.4367FALSE
461.8766FALSE
468.4367FALSE
461.8764FALSE
461.8768FALSE
468.4367FALSE
461.8766FALSE
468.4367FALSE
461.8765FALSE
468.4367FALSE
461.8566FALSE
468.4367FALSE
461.8564FALSE
468.4367FALSE
461.8567FALSE
468.4367FALSE
461.8565FALSE
461.8566FALSE
468.4367FALSE
461.9429FALSE
468.4367FALSE
461.9429FALSE
468.4367FALSE
461.9429FALSE
468.4367FALSE
461.9454FALSE
468.4367FALSE
461.9404FALSE
468.4367FALSE
461.8358FALSE
468.4367FALSE
461.8358FALSE
468.4367FALSE
461.8359FALSE
461.8363FALSE
468.4367FALSE
461.8353FALSE
468.4367FALSE
461.8271FALSE
468.4367FALSE
461.827FALSE
468.4367FALSE
461.8272FALSE
468.4367FALSE
461.8276FALSE
693.466FALSE
461.8266FALSE
693.4049FALSE
461.8024FALSE
461.8024FALSE
693.527FALSE
461.8024FALSE
693.4681FALSE
461.8028FALSE
693.4638FALSE
461.802FALSE
468.4367FALSE
461.8048FALSE
468.4367FALSE
461.8048FALSE
468.4367FALSE
461.8048FALSE
461.8043FALSE
468.4367FALSE
461.8053FALSE
468.4367FALSE
461.7992FALSE
468.4367FALSE
461.7992FALSE
461.7992FALSE
468.4367FALSE
461.7991FALSE
461.7993FALSE
468.4367FALSE
461.7955FALSE
461.7954FALSE
468.4367FALSE
461.7955FALSE
461.7953FALSE
468.4367FALSE
461.7956FALSE
461.788FALSE
466.3282FALSE
461.788FALSE
461.788FALSE
466.3203FALSE
461.7877FALSE
466.3361FALSE
461.7882FALSE
461.822FALSE
466.321FALSE
461.822FALSE
466.3357FALSE
461.822FALSE
468.4367FALSE
461.8227FALSE
468.4367FALSE
461.8212FALSE
468.4367FALSE
461.7897FALSE
461.7897FALSE
468.4367FALSE
461.7897FALSE
468.4367FALSE
461.79FALSE
468.4194FALSE
461.7894FALSE
461.7876FALSE
468.4192FALSE
461.7876FALSE
468.4196FALSE
461.7876FALSE
468.4193FALSE
461.788FALSE
468.4196FALSE
461.7874FALSE
468.4367FALSE
461.7868FALSE
468.4367FALSE
461.7868FALSE
461.7868FALSE
468.4367FALSE
461.7872FALSE
468.4367FALSE
461.7871FALSE
468.4367FALSE
461.786FALSE
468.4367FALSE
461.786FALSE
468.4367FALSE
461.786FALSE
461.786FALSE
468.4367FALSE
461.7863FALSE
468.4367FALSE
461.7854FALSE
468.4367FALSE
461.7854FALSE
468.4367FALSE
461.7854FALSE
468.4367FALSE
461.7855FALSE
468.4367FALSE
461.7857FALSE
468.4367FALSE
461.785FALSE
468.4367FALSE
461.785FALSE
468.4367FALSE
461.785FALSE
468.4367FALSE
461.7853FALSE
468.4367FALSE
468.4367FALSE
461.7853FALSE
468.4367FALSE
461.7849FALSE
468.4367FALSE
461.7849FALSE
468.4367FALSE
461.7849FALSE
468.4367FALSE
461.7852FALSE
468.4367FALSE
461.7852FALSE
468.4367FALSE
461.7851FALSE
468.4367FALSE
461.7851FALSE
468.4367FALSE
461.7851FALSE
468.4367FALSE
461.7848FALSE
468.4367FALSE
461.7853FALSE
468.4367FALSE
461.7849FALSE
468.4367FALSE
461.7849FALSE
468.4367FALSE
461.7849FALSE
468.4367FALSE
468.4367FALSE
461.7851FALSE
468.4367FALSE
461.7852FALSE
468.4367FALSE
461.7849FALSE
468.4367FALSE
461.7849FALSE
468.4367FALSE
461.7849FALSE
468.4367FALSE
461.7852FALSE
468.4367FALSE
461.7852FALSE
468.4367FALSE
468.4367FALSE
461.7849FALSE
468.4367FALSE
461.7849FALSE
468.4367FALSE
461.7849FALSE
468.4367FALSE
461.7852FALSE
468.4367FALSE
461.7852FALSE
468.4367FALSE
468.4367FALSE
461.7849FALSE
468.4367FALSE
461.7849FALSE
468.4367FALSE
461.7849FALSE
468.4367FALSE
461.7852FALSE
468.4367FALSE
461.7852FALSE
468.4367FALSE
461.7849FALSE
468.4367FALSE
461.7849FALSE
468.4367FALSE
461.7849FALSE
468.4367FALSE
461.7852FALSE
468.4367FALSE
461.7852FALSE
468.4367FALSE
461.7849FALSE
468.4367FALSE
461.7849FALSE
468.4367FALSE
461.7849FALSE
468.4367FALSE
461.7852FALSE
468.4367FALSE
461.7852FALSE
468.4367FALSE
461.7849FALSE
468.4367FALSE
461.7849FALSE
468.4367FALSE
461.7849FALSE
572.7357FALSE
461.7852FALSE
572.7055FALSE
461.7852FALSE
572.7659FALSE
461.7849FALSE
572.7357FALSE
461.7849FALSE
572.7357FALSE
461.7849FALSE
468.4367FALSE
461.7852FALSE
468.4367FALSE
461.7852FALSE
468.4367FALSE
461.7849FALSE
468.4367FALSE
461.7849FALSE
468.4367FALSE
461.7849FALSE
468.4367FALSE
461.7852FALSE
468.4367FALSE
461.7852FALSE
468.4367FALSE
461.7849FALSE
468.4367FALSE
461.7849FALSE
468.4367FALSE
468.4124FALSE
461.7849FALSE
468.4124FALSE
461.7852FALSE
468.4124FALSE
461.7852FALSE
468.4124FALSE
461.7849FALSE
468.4124FALSE
461.7849FALSE
468.4124FALSE
461.7849FALSE
468.4124FALSE
468.4124FALSE
461.7852FALSE
468.4124FALSE
461.7852FALSE
468.4124FALSE
461.7849FALSE
468.4124FALSE
461.7849FALSE
468.4124FALSE
468.4124FALSE
461.7849FALSE
468.4124FALSE
461.7852FALSE
468.4124FALSE
461.7852FALSE
482.6784FALSE
461.7849FALSE
482.6477FALSE
461.7849FALSE
482.7092FALSE
461.7849FALSE
482.6784FALSE
461.7852FALSE
482.6784FALSE
$par
smooth_log_cases_lag0.bw         time_ind_lag0.bw 
                7.388273               -10.548241 

$value
[1] 468.4367

$counts
function gradient 
      43       43 

$convergence
[1] 52

$message
[1] "ERROR: ABNORMAL_TERMINATION_IN_LNSRCH"

461.7852FALSE
461.7849FALSE
461.7849FALSE
461.7849FALSE
461.7852FALSE
461.7852FALSE
461.7849FALSE
461.7849FALSE
461.7849FALSE
461.7852FALSE
461.7852FALSE
461.7849FALSE
461.7849FALSE
461.7849FALSE
461.7852FALSE
461.7852FALSE
461.7849FALSE
461.7849FALSE
461.7849FALSE
461.7852FALSE
461.7852FALSE
461.7849FALSE
461.7849FALSE
461.7849FALSE
461.7852FALSE
461.7852FALSE
461.7849FALSE
461.7849FALSE
461.7849FALSE
461.7852FALSE
461.7852FALSE
461.7886FALSE
461.7886FALSE
461.7886FALSE
461.7885FALSE
461.7887FALSE
461.785FALSE
461.785FALSE
461.785FALSE
461.7851FALSE
461.7853FALSE
461.7849FALSE
461.7849FALSE
461.7849FALSE
461.7852FALSE
461.7852FALSE
461.7849FALSE
461.7849FALSE
461.7849FALSE
461.7852FALSE
461.7852FALSE
461.7849FALSE
461.7849FALSE
461.7849FALSE
461.7852FALSE
461.7852FALSE
461.7849FALSE
461.7849FALSE
461.7849FALSE
461.7852FALSE
461.7852FALSE
461.7849FALSE
461.7849FALSE
461.7849FALSE
461.7852FALSE
461.7852FALSE
461.7849FALSE
461.7849FALSE
461.7849FALSE
461.7852FALSE
461.7852FALSE
461.7849FALSE
461.7849FALSE
461.7849FALSE
461.7852FALSE
461.7852FALSE
461.7849FALSE
461.7849FALSE
461.7849FALSE
461.7852FALSE
461.7852FALSE
461.7849FALSE
461.7849FALSE
461.7849FALSE
461.7852FALSE
461.7852FALSE
461.7849FALSE
461.7849FALSE
461.7849FALSE
461.7852FALSE
461.7852FALSE
461.7849FALSE
461.7849FALSE
461.7849FALSE
461.7852FALSE
461.7852FALSE
461.7849FALSE
461.7849FALSE
461.7849FALSE
461.7852FALSE
461.7852FALSE
461.7849FALSE
461.7849FALSE
461.7849FALSE
461.7852FALSE
461.7852FALSE
$par
smooth_log_cases_lag1.bw         time_ind_lag0.bw 
                4.574389                -1.904159 

$value
[1] 461.7849

$counts
function gradient 
      64       64 

$convergence
[1] 0

$message
[1] "CONVERGENCE: REL_REDUCTION_OF_F <= FACTR*EPSMCH"

> 
> save(ssr_fit,
+     file=paste0("/home/ngr67a/2015-cdc-flu-competition/fit-competition-ssr-ph", prediction_horizon_limit, "-", data_set, ".Rdata"))
> 
> proc.time()
    user   system  elapsed 
1022.184    0.497  990.336 
