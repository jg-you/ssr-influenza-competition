
R version 3.2.2 (2015-08-14) -- "Fire Safety"
Copyright (C) 2015 The R Foundation for Statistical Computing
Platform: x86_64-pc-linux-gnu (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

  Natural language support but running in an English locale

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> ### get ssr fit -- prediction horizons 1:52
> library(lubridate)
> library(ggplot2)
> library(plyr)

Attaching package: ‘plyr’

The following object is masked from ‘package:lubridate’:

    here

> library(dplyr)

Attaching package: ‘dplyr’

The following objects are masked from ‘package:plyr’:

    arrange, count, desc, failwith, id, mutate, rename, summarise,
    summarize

The following objects are masked from ‘package:lubridate’:

    intersect, setdiff, union

The following objects are masked from ‘package:stats’:

    filter, lag

The following objects are masked from ‘package:base’:

    intersect, setdiff, setequal, union

> library(reshape)

Attaching package: ‘reshape’

The following object is masked from ‘package:dplyr’:

    rename

The following objects are masked from ‘package:plyr’:

    rename, round_any

The following object is masked from ‘package:lubridate’:

    stamp

> library(ssrFlu)
> library(doMC)
Loading required package: foreach
Loading required package: iterators
Loading required package: parallel
> 
> registerDoMC(cores=3)
> 
> args <- commandArgs(trailingOnly=TRUE)
> 
> data_set <- args[1]
> prediction_horizon_limit <- as.integer(args[2])
> 
> ## load dataset
> if(identical(data_set, "ili_national")) {
+     data <- ili_national
+ } 
> if(identical(data_set, "ili_region1")) {
+     data <- ili_region1
+ } 
> if(identical(data_set, "ili_region2")) {
+     data <- ili_region2
+ } 
> if(identical(data_set, "ili_region3")) {
+     data <- ili_region3
+ } 
> if(identical(data_set, "ili_region4")) {
+     data <- ili_region4
+ } 
> if(identical(data_set, "ili_region5")) {
+     data <- ili_region5
+ } 
> if(identical(data_set, "ili_region6")) {
+     data <- ili_region6
+ } 
> if(identical(data_set, "ili_region7")) {
+     data <- ili_region7
+ } 
> if(identical(data_set, "ili_region8")) {
+     data <- ili_region8
+ } 
> if(identical(data_set, "ili_region9")) {
+     data <- ili_region9
+ } 
> if(identical(data_set, "ili_region10")) {
+     data <- ili_region10
+ } 
> 
> 
> 
> ## add log column
> data$log_total_cases <- log(data$total_cases + 1)
> 
> ## add week_start_date
> char_dates <- paste(data$year, data$week, "1")
> data$week_start_date <- as.Date(char_dates, format="%Y %W %w")
> 
> ## remove week 53s
> data <- data[-which(is.na(data$week_start_date)),]
> data <- data[262:nrow(data),]
> 
> ## add smooth log column -- or not, since it is already pretty smooth...
> sm <- loess(log_total_cases ~ as.numeric(week_start_date), data=data, span= 26 / nrow(data))
> data$smooth_log_cases <- sm$fitted
> 
> ## add time column
> data$time_ind <- seq_len(nrow(data))
> 
> ssr_control <- create_ssr_control(X_names=c("smooth_log_cases", "time_ind"),
+     y_names="total_cases",
+     time_name=NULL,
+     max_lag=list(smooth_log_cases=1,
+         time_ind=0),
+     prediction_horizons=as.integer(prediction_horizon_limit),
+     kernel_fns=list(smooth_log_cases="squared_exp_kernel",
+         time_ind="periodic_kernel"),
+     theta_est=list(smooth_log_cases="bw",
+         time_ind="bw"),
+     theta_fixed=list(time_ind=list(period=pi / 52)),
+     theta_transform_fns=list(
+         squared_exp_kernel=list(
+             bw=list(transform="log",
+                 detransform="exp")
+         ),
+         periodic_kernel=list(
+             bw=list(transform="log",
+                 detransform="exp")
+         )
+     ),
+     crossval_buffer=52,
+     loss_fn_name="mae_from_kernel_weights_and_centers",
+     loss_fn_args=list())
> 
> 
> ssr_fit <- ssr(X_names=c("smooth_log_cases", "time_ind"),
+     y_names="total_cases",
+     time_name=NULL,
+     data=data,
+     ssr_control=ssr_control)
502.5781FALSE
389.2946FALSE
505.792FALSE
502.5648FALSE
389.2931FALSE
505.7751FALSE
502.5915FALSE
389.2961FALSE
505.8089FALSE
502.6971FALSE
397.3401FALSE
502.7237FALSE
397.3714FALSE
503.832FALSE
502.6706FALSE
397.3089FALSE
503.8573FALSE
497.885FALSE
389.1755FALSE
503.8068FALSE
497.8841FALSE
389.1758FALSE
497.8858FALSE
500.4972FALSE
389.1751FALSE
497.8664FALSE
497.8668FALSE
500.4885FALSE
389.173FALSE
497.8661FALSE
389.1729FALSE
500.5059FALSE
497.8672FALSE
389.173FALSE
497.8668FALSE
500.7726FALSE
389.1727FALSE
497.8675FALSE
500.7833FALSE
389.1726FALSE
497.8653FALSE
389.1727FALSE
497.8656FALSE
500.762FALSE
389.1719FALSE
497.8654FALSE
499.6129FALSE
389.1723FALSE
499.6131FALSE
497.8657FALSE
389.1716FALSE
499.6128FALSE
497.8654FALSE
499.6125FALSE
389.1724FALSE
497.866FALSE
389.1724FALSE
499.6125FALSE
497.8653FALSE
389.1725FALSE
499.6124FALSE
497.8655FALSE
389.1714FALSE
499.6123FALSE
497.8655FALSE
499.6123FALSE
389.1712FALSE
497.8652FALSE
499.6123FALSE
389.1715FALSE
497.8655FALSE
389.1712FALSE
497.8655FALSE
499.6123FALSE
389.1711FALSE
497.8652FALSE
499.6123FALSE
389.1713FALSE
497.8655FALSE
499.6123FALSE
$par
smooth_log_cases_lag1.bw 
               -1.709371 

$value
[1] 499.6123

$counts
function gradient 
       8        8 

$convergence
[1] 0

$message
[1] "CONVERGENCE: REL_REDUCTION_OF_F <= FACTR*EPSMCH"

389.1711FALSE
497.8655FALSE
$par
smooth_log_cases_lag0.bw 
               -1.734303 

$value
[1] 497.8652

$counts
function gradient 
      10       10 

$convergence
[1] 0

$message
[1] "CONVERGENCE: REL_REDUCTION_OF_F <= FACTR*EPSMCH"

389.1713FALSE
389.1712FALSE
389.1715FALSE
389.1714FALSE
389.1716FALSE
389.1711FALSE
389.1712FALSE
389.1712FALSE
389.1711FALSE
389.1713FALSE
389.1712FALSE
389.1711FALSE
389.1713FALSE
389.1712FALSE
389.1711FALSE
389.1713FALSE
389.1712FALSE
389.1711FALSE
389.1713FALSE
389.1712FALSE
389.1711FALSE
389.1713FALSE
389.1712FALSE
389.1711FALSE
389.1713FALSE
389.1712FALSE
389.1711FALSE
389.1713FALSE
389.1712FALSE
389.1711FALSE
389.1713FALSE
389.1712FALSE
389.1711FALSE
389.1713FALSE
389.1712FALSE
389.1711FALSE
389.1713FALSE
389.1712FALSE
389.1711FALSE
389.1713FALSE
389.1712FALSE
389.1711FALSE
389.1713FALSE
389.1712FALSE
389.1711FALSE
389.1713FALSE
389.1712FALSE
389.1711FALSE
389.1713FALSE
389.1712FALSE
389.1711FALSE
389.1713FALSE
389.1712FALSE
389.1711FALSE
389.1713FALSE
389.1712FALSE
389.1711FALSE
389.1713FALSE
389.1712FALSE
389.1711FALSE
389.1713FALSE
389.1712FALSE
389.1722FALSE
389.1721FALSE
389.1723FALSE
389.1711FALSE
389.1712FALSE
389.1713FALSE
389.1711FALSE
389.1713FALSE
389.1712FALSE
389.1711FALSE
389.1713FALSE
389.1712FALSE
389.1711FALSE
389.1713FALSE
389.1712FALSE
389.1711FALSE
389.1713FALSE
389.1712FALSE
389.1711FALSE
389.1713FALSE
389.1712FALSE
389.1711FALSE
389.1713FALSE
389.1712FALSE
389.1711FALSE
389.1713FALSE
389.1712FALSE
389.1711FALSE
389.1713FALSE
389.1712FALSE
389.1711FALSE
389.1713FALSE
389.1712FALSE
389.1711FALSE
389.1713FALSE
389.1712FALSE
389.1711FALSE
389.1713FALSE
389.1712FALSE
$par
time_ind_lag0.bw 
       -2.118489 

$value
[1] 389.1711

$counts
function gradient 
      43       43 

$convergence
[1] 0

$message
[1] "CONVERGENCE: REL_REDUCTION_OF_F <= FACTR*EPSMCH"

425.947FALSE
425.7962FALSE
425.9174FALSE
425.7628FALSE
425.9765FALSE
425.8295FALSE
425.9624FALSE
425.8057FALSE
425.9319FALSE
425.7866FALSE
397.4113FALSE
396.5085FALSE
397.3989FALSE
397.4238FALSE
396.4963FALSE
397.4114FALSE
396.5207FALSE
397.4112FALSE
392.5028FALSE
396.5112FALSE
392.4987FALSE
396.5057FALSE
392.507FALSE
392.7374FALSE
392.5012FALSE
392.7334FALSE
392.5044FALSE
392.7414FALSE
390.954FALSE
392.7361FALSE
390.9512FALSE
392.7389FALSE
391.4323FALSE
390.9569FALSE
390.9525FALSE
391.4291FALSE
390.9556FALSE
391.4354FALSE
390.4666FALSE
390.4661FALSE
391.4308FALSE
390.4672FALSE
391.4337FALSE
390.4753FALSE
395.4471FALSE
395.447FALSE
390.458FALSE
395.4473FALSE
389.9503FALSE
395.47FALSE
389.9488FALSE
395.4243FALSE
389.9519FALSE
390.1604FALSE
389.9514FALSE
390.1587FALSE
390.1621FALSE
389.9492FALSE
390.1623FALSE
389.6021FALSE
390.1584FALSE
389.6013FALSE
389.6164FALSE
389.6029FALSE
389.6156FALSE
389.6027FALSE
389.6172FALSE
389.6016FALSE
389.6174FALSE
389.3992FALSE
389.6156FALSE
389.3988FALSE
389.4057FALSE
389.3997FALSE
389.4053FALSE
389.3997FALSE
389.4062FALSE
389.3988FALSE
389.4057FALSE
389.2761FALSE
389.4057FALSE
389.2759FALSE
389.2785FALSE
389.2783FALSE
389.2763FALSE
389.2762FALSE
389.2787FALSE
389.276FALSE
389.2785FALSE
389.227FALSE
389.2269FALSE
389.2786FALSE
389.2271FALSE
389.2238FALSE
389.2268FALSE
389.2237FALSE
389.2272FALSE
389.2239FALSE
389.2237FALSE
389.194FALSE
389.2239FALSE
389.1939FALSE
389.2064FALSE
389.194FALSE
389.2064FALSE
389.1944FALSE
389.2065FALSE
389.1936FALSE
389.2071FALSE
389.1869FALSE
389.2059FALSE
389.1868FALSE
389.1901FALSE
389.1869FALSE
389.19FALSE
389.1868FALSE
389.1901FALSE
389.1869FALSE
389.1904FALSE
389.1897FALSE
389.1803FALSE
389.1799FALSE
389.1803FALSE
389.1799FALSE
389.1803FALSE
389.18FALSE
389.1802FALSE
389.1799FALSE
389.1803FALSE
389.18FALSE
389.1761FALSE
389.1779FALSE
389.1761FALSE
389.1779FALSE
389.1761FALSE
389.1779FALSE
389.176FALSE
389.1778FALSE
389.1762FALSE
389.1779FALSE
389.1731FALSE
389.1752FALSE
389.1731FALSE
389.1752FALSE
389.1731FALSE
389.1752FALSE
389.1752FALSE
389.173FALSE
389.1753FALSE
389.1732FALSE
389.174FALSE
389.1845FALSE
389.174FALSE
389.174FALSE
389.1845FALSE
389.1739FALSE
389.1845FALSE
389.1741FALSE
389.1851FALSE
389.2697FALSE
389.2697FALSE
389.1839FALSE
389.2697FALSE
389.1729FALSE
389.2709FALSE
389.1729FALSE
389.2685FALSE
389.1729FALSE
389.1736FALSE
389.1732FALSE
389.1736FALSE
389.1736FALSE
389.1725FALSE
389.1735FALSE
389.1727FALSE
389.1737FALSE
389.1727FALSE
389.1731FALSE
389.1727FALSE
389.1731FALSE
389.1725FALSE
389.1731FALSE
389.1728FALSE
389.173FALSE
389.1724FALSE
389.1732FALSE
389.1967FALSE
389.1724FALSE
389.1967FALSE
389.1724FALSE
389.1967FALSE
389.1726FALSE
389.1977FALSE
389.1725FALSE
389.1958FALSE
389.1723FALSE
389.1722FALSE
389.1723FALSE
389.1722FALSE
389.1723FALSE
389.1722FALSE
389.1722FALSE
389.1724FALSE
389.1724FALSE
389.1723FALSE
389.1726FALSE
389.1716FALSE
389.1726FALSE
389.1716FALSE
389.1726FALSE
389.1716FALSE
389.173FALSE
389.1719FALSE
389.1723FALSE
389.1715FALSE
389.1721FALSE
389.1715FALSE
389.1721FALSE
389.1715FALSE
389.1721FALSE
389.1715FALSE
389.1721FALSE
389.1714FALSE
389.1716FALSE
389.1722FALSE
389.1714FALSE
389.3318FALSE
389.1714FALSE
389.3318FALSE
389.1714FALSE
389.3318FALSE
389.1713FALSE
389.3336FALSE
389.1715FALSE
389.3301FALSE
389.1716FALSE
389.1726FALSE
389.1716FALSE
389.1726FALSE
389.1716FALSE
389.1727FALSE
389.1719FALSE
389.173FALSE
389.1713FALSE
389.1723FALSE
389.1712FALSE
389.172FALSE
389.1712FALSE
389.172FALSE
389.1712FALSE
389.172FALSE
389.1713FALSE
389.1713FALSE
389.1721FALSE
389.1712FALSE
389.1722FALSE
389.1712FALSE
389.1717FALSE
389.1712FALSE
389.1713FALSE
389.1717FALSE
389.1713FALSE
389.1717FALSE
389.1712FALSE
389.1718FALSE
389.1712FALSE
389.1718FALSE
389.1712FALSE
389.1714FALSE
389.1712FALSE
389.1714FALSE
389.1713FALSE
389.1714FALSE
389.1712FALSE
389.1715FALSE
389.1712FALSE
389.1712FALSE
389.1715FALSE
389.1713FALSE
389.1713FALSE
389.1713FALSE
389.1713FALSE
389.1711FALSE
389.1713FALSE
389.1711FALSE
389.1714FALSE
389.1711FALSE
389.1714FALSE
389.1713FALSE
389.1712FALSE
389.1713FALSE
389.1712FALSE
389.1712FALSE
389.1711FALSE
389.1711FALSE
389.1713FALSE
389.1711FALSE
389.1713FALSE
389.1713FALSE
389.1712FALSE
389.1713FALSE
389.1712FALSE
389.1711FALSE
389.1712FALSE
389.1711FALSE
389.1713FALSE
389.1711FALSE
389.1713FALSE
389.1713FALSE
390.2901FALSE
389.1713FALSE
389.1711FALSE
390.2901FALSE
389.1711FALSE
390.2901FALSE
389.1711FALSE
390.2993FALSE
389.1712FALSE
390.2809FALSE
389.1713FALSE
389.1762FALSE
389.1711FALSE
389.1762FALSE
389.1711FALSE
389.1762FALSE
389.1711FALSE
389.1765FALSE
389.1712FALSE
389.1713FALSE
389.1759FALSE
389.1711FALSE
389.1712FALSE
389.1711FALSE
389.1712FALSE
389.1711FALSE
389.1713FALSE
389.1712FALSE
389.1713FALSE
389.1713FALSE
389.1711FALSE
389.1713FALSE
$par
smooth_log_cases_lag0.bw         time_ind_lag0.bw 
                5.149718                -2.118557 

$value
[1] 389.1712

$counts
function gradient 
      34       34 

$convergence
[1] 0

$message
[1] "CONVERGENCE: REL_REDUCTION_OF_F <= FACTR*EPSMCH"

389.1711FALSE
389.1711FALSE
389.1713FALSE
389.1713FALSE
389.1711FALSE
389.1711FALSE
389.1711FALSE
389.1713FALSE
389.1713FALSE
389.1711FALSE
389.1711FALSE
389.1711FALSE
389.1713FALSE
389.1713FALSE
389.1711FALSE
389.1711FALSE
389.1711FALSE
389.1713FALSE
389.1713FALSE
389.1711FALSE
389.1711FALSE
389.1711FALSE
389.1713FALSE
389.1713FALSE
389.1711FALSE
389.1711FALSE
389.1711FALSE
389.1713FALSE
389.1713FALSE
389.1711FALSE
389.1711FALSE
389.1711FALSE
389.1713FALSE
389.1713FALSE
389.1711FALSE
389.1711FALSE
389.1711FALSE
389.1713FALSE
389.1713FALSE
389.1711FALSE
389.1711FALSE
389.1711FALSE
389.1713FALSE
389.1713FALSE
$par
smooth_log_cases_lag1.bw         time_ind_lag0.bw 
                6.015518                -2.118559 

$value
[1] 389.1711

$counts
function gradient 
      43       43 

$convergence
[1] 0

$message
[1] "CONVERGENCE: REL_REDUCTION_OF_F <= FACTR*EPSMCH"

> 
> save(ssr_fit,
+     file=paste0("/home/ngr67a/2015-cdc-flu-competition/fit-competition-ssr-ph", prediction_horizon_limit, "-", data_set, ".Rdata"))
> 
> proc.time()
   user  system elapsed 
766.155   0.818 722.883 
