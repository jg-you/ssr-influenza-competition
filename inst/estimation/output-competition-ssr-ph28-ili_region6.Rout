
R version 3.2.2 (2015-08-14) -- "Fire Safety"
Copyright (C) 2015 The R Foundation for Statistical Computing
Platform: x86_64-pc-linux-gnu (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

  Natural language support but running in an English locale

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> ### get ssr fit -- prediction horizons 1:52
> library(lubridate)
> library(ggplot2)
> library(plyr)

Attaching package: ‘plyr’

The following object is masked from ‘package:lubridate’:

    here

> library(dplyr)

Attaching package: ‘dplyr’

The following objects are masked from ‘package:plyr’:

    arrange, count, desc, failwith, id, mutate, rename, summarise,
    summarize

The following objects are masked from ‘package:lubridate’:

    intersect, setdiff, union

The following objects are masked from ‘package:stats’:

    filter, lag

The following objects are masked from ‘package:base’:

    intersect, setdiff, setequal, union

> library(reshape)

Attaching package: ‘reshape’

The following object is masked from ‘package:dplyr’:

    rename

The following objects are masked from ‘package:plyr’:

    rename, round_any

The following object is masked from ‘package:lubridate’:

    stamp

> library(ssrFlu)
> library(doMC)
Loading required package: foreach
Loading required package: iterators
Loading required package: parallel
> 
> registerDoMC(cores=3)
> 
> args <- commandArgs(trailingOnly=TRUE)
> 
> data_set <- args[1]
> prediction_horizon_limit <- as.integer(args[2])
> 
> ## load dataset
> if(identical(data_set, "ili_national")) {
+     data <- ili_national
+ } 
> if(identical(data_set, "ili_region1")) {
+     data <- ili_region1
+ } 
> if(identical(data_set, "ili_region2")) {
+     data <- ili_region2
+ } 
> if(identical(data_set, "ili_region3")) {
+     data <- ili_region3
+ } 
> if(identical(data_set, "ili_region4")) {
+     data <- ili_region4
+ } 
> if(identical(data_set, "ili_region5")) {
+     data <- ili_region5
+ } 
> if(identical(data_set, "ili_region6")) {
+     data <- ili_region6
+ } 
> if(identical(data_set, "ili_region7")) {
+     data <- ili_region7
+ } 
> if(identical(data_set, "ili_region8")) {
+     data <- ili_region8
+ } 
> if(identical(data_set, "ili_region9")) {
+     data <- ili_region9
+ } 
> if(identical(data_set, "ili_region10")) {
+     data <- ili_region10
+ } 
> 
> 
> 
> ## add log column
> data$log_total_cases <- log(data$total_cases + 1)
> 
> ## add week_start_date
> char_dates <- paste(data$year, data$week, "1")
> data$week_start_date <- as.Date(char_dates, format="%Y %W %w")
> 
> ## remove week 53s
> data <- data[-which(is.na(data$week_start_date)),]
> data <- data[262:nrow(data),]
> 
> ## add smooth log column -- or not, since it is already pretty smooth...
> sm <- loess(log_total_cases ~ as.numeric(week_start_date), data=data, span= 26 / nrow(data))
> data$smooth_log_cases <- sm$fitted
> 
> ## add time column
> data$time_ind <- seq_len(nrow(data))
> 
> ssr_control <- create_ssr_control(X_names=c("smooth_log_cases", "time_ind"),
+     y_names="total_cases",
+     time_name=NULL,
+     max_lag=list(smooth_log_cases=1,
+         time_ind=0),
+     prediction_horizons=as.integer(prediction_horizon_limit),
+     kernel_fns=list(smooth_log_cases="squared_exp_kernel",
+         time_ind="periodic_kernel"),
+     theta_est=list(smooth_log_cases="bw",
+         time_ind="bw"),
+     theta_fixed=list(time_ind=list(period=pi / 52)),
+     theta_transform_fns=list(
+         squared_exp_kernel=list(
+             bw=list(transform="log",
+                 detransform="exp")
+         ),
+         periodic_kernel=list(
+             bw=list(transform="log",
+                 detransform="exp")
+         )
+     ),
+     crossval_buffer=52,
+     loss_fn_name="mae_from_kernel_weights_and_centers",
+     loss_fn_args=list())
> 
> 
> ssr_fit <- ssr(X_names=c("smooth_log_cases", "time_ind"),
+     y_names="total_cases",
+     time_name=NULL,
+     data=data,
+     ssr_control=ssr_control)
902.96FALSE
695.3233FALSE
902.4036FALSE
902.9187FALSE
695.3137FALSE
902.4081FALSE
903.0013FALSE
695.3329FALSE
902.3988FALSE
892.2134FALSE
694.9572FALSE
896.7172FALSE
892.2339FALSE
694.9998FALSE
896.7117FALSE
892.1929FALSE
694.9146FALSE
896.7226FALSE
888.2377FALSE
693.4733FALSE
889.5956FALSE
888.2385FALSE
693.4632FALSE
888.2369FALSE
889.6055FALSE
693.4834FALSE
888.2317FALSE
690.0436FALSE
889.5856FALSE
888.2319FALSE
690.0412FALSE
894.674FALSE
888.2316FALSE
690.0462FALSE
894.6595FALSE
888.2315FALSE
691.5004FALSE
894.6883FALSE
888.2315FALSE
691.525FALSE
889.6385FALSE
888.2315FALSE
691.4758FALSE
889.6243FALSE
888.2315FALSE
689.964FALSE
889.6527FALSE
888.2315FALSE
689.9643FALSE
889.5956FALSE
888.2315FALSE
$par
smooth_log_cases_lag0.bw 
               -1.650252 

$value
[1] 888.2315

$counts
function gradient 
       6        6 

$convergence
[1] 0

$message
[1] "CONVERGENCE: REL_REDUCTION_OF_F <= FACTR*EPSMCH"

689.9637FALSE
889.6055FALSE
689.9623FALSE
889.5856FALSE
689.9626FALSE
1145.093FALSE
689.962FALSE
1145.093FALSE
689.9849FALSE
1145.093FALSE
689.9825FALSE
896.6934FALSE
689.9873FALSE
896.6876FALSE
689.9614FALSE
896.6991FALSE
689.9617FALSE
889.84FALSE
689.9612FALSE
889.8284FALSE
689.9679FALSE
889.8521FALSE
689.9655FALSE
889.5345FALSE
689.9703FALSE
889.5326FALSE
689.9603FALSE
889.5362FALSE
689.9606FALSE
889.5303FALSE
689.9601FALSE
889.5283FALSE
690.1846FALSE
889.5323FALSE
690.1789FALSE
889.5604FALSE
690.1903FALSE
889.5706FALSE
689.9595FALSE
889.55FALSE
689.9598FALSE
889.5267FALSE
689.9593FALSE
889.5243FALSE
690.0752FALSE
889.5288FALSE
690.0719FALSE
889.5246FALSE
690.0785FALSE
889.5221FALSE
689.9592FALSE
889.5269FALSE
689.9594FALSE
889.529FALSE
889.5396FALSE
689.9599FALSE
889.5195FALSE
689.9597FALSE
889.5216FALSE
689.96FALSE
889.5202FALSE
689.9594FALSE
889.5241FALSE
889.5198FALSE
689.9592FALSE
889.5275FALSE
689.9595FALSE
889.5225FALSE
689.9594FALSE
889.5209FALSE
689.9592FALSE
889.5234FALSE
689.9594FALSE
889.5234FALSE
689.9598FALSE
889.5209FALSE
689.9592FALSE
889.5235FALSE
689.9594FALSE
889.5234FALSE
889.5209FALSE
689.9599FALSE
889.5234FALSE
689.9592FALSE
889.5234FALSE
$par
smooth_log_cases_lag1.bw 
               -2.771136 

$value
[1] 889.5209

$counts
function gradient 
      20       20 

$convergence
[1] 0

$message
[1] "CONVERGENCE: REL_REDUCTION_OF_F <= FACTR*EPSMCH"

689.9594FALSE
689.9599FALSE
689.9592FALSE
689.9594FALSE
689.9599FALSE
689.9592FALSE
689.9594FALSE
689.9599FALSE
689.9592FALSE
689.9594FALSE
689.9599FALSE
689.9592FALSE
689.9594FALSE
689.9599FALSE
689.9592FALSE
689.9594FALSE
689.9599FALSE
689.9592FALSE
689.9594FALSE
689.9599FALSE
689.9592FALSE
689.9594FALSE
689.9599FALSE
689.9592FALSE
689.9594FALSE
689.9599FALSE
689.9592FALSE
689.9594FALSE
689.9599FALSE
689.9592FALSE
689.9594FALSE
689.9599FALSE
689.9592FALSE
689.9594FALSE
689.9599FALSE
689.9592FALSE
689.9594FALSE
689.9599FALSE
689.9592FALSE
689.9594FALSE
689.9599FALSE
689.9592FALSE
689.9594FALSE
689.9599FALSE
689.9592FALSE
689.9594FALSE
689.9599FALSE
692.4007FALSE
692.4311FALSE
692.3702FALSE
689.9608FALSE
689.9611FALSE
689.9606FALSE
689.9594FALSE
689.9596FALSE
689.9591FALSE
689.9592FALSE
689.9594FALSE
689.9597FALSE
689.9592FALSE
689.9594FALSE
689.9599FALSE
689.9592FALSE
689.9594FALSE
689.9599FALSE
689.9592FALSE
689.9594FALSE
689.9599FALSE
689.9592FALSE
689.9594FALSE
689.9599FALSE
689.9592FALSE
689.9594FALSE
689.9599FALSE
689.9592FALSE
689.9594FALSE
689.9599FALSE
689.9592FALSE
689.9594FALSE
689.9599FALSE
689.9592FALSE
689.9594FALSE
689.9599FALSE
689.9592FALSE
689.9594FALSE
689.9599FALSE
689.9592FALSE
689.9594FALSE
689.9599FALSE
689.9592FALSE
689.9594FALSE
689.9599FALSE
689.9592FALSE
689.9594FALSE
689.9599FALSE
689.9592FALSE
689.9594FALSE
689.9599FALSE
689.9592FALSE
689.9594FALSE
689.9599FALSE
689.9592FALSE
689.9594FALSE
689.9599FALSE
689.9592FALSE
689.9594FALSE
689.9599FALSE
$par
time_ind_lag0.bw 
       -1.600564 

$value
[1] 689.9592

$counts
function gradient 
      55       55 

$convergence
[1] 0

$message
[1] "CONVERGENCE: REL_REDUCTION_OF_F <= FACTR*EPSMCH"

743.619FALSE
747.9469FALSE
747.8793FALSE
743.5551FALSE
748.0146FALSE
743.6828FALSE
748.0069FALSE
743.678FALSE
747.8886FALSE
743.56FALSE
703.8562FALSE
703.3325FALSE
703.8425FALSE
703.3236FALSE
703.8699FALSE
703.3415FALSE
703.849FALSE
703.8634FALSE
703.325FALSE
701.7398FALSE
703.3401FALSE
701.7302FALSE
701.7972FALSE
701.7493FALSE
701.79FALSE
701.7357FALSE
701.8043FALSE
701.7438FALSE
701.7918FALSE
697.7397FALSE
701.8025FALSE
697.7327FALSE
697.4558FALSE
697.7468FALSE
697.4476FALSE
697.7319FALSE
697.4639FALSE
697.7475FALSE
697.4503FALSE
811.1784FALSE
697.4613FALSE
811.1785FALSE
718.2317FALSE
811.1783FALSE
718.2302FALSE
811.4647FALSE
718.2333FALSE
810.8919FALSE
718.3812FALSE
694.1973FALSE
718.0839FALSE
694.1934FALSE
694.6873FALSE
694.2012FALSE
694.6837FALSE
694.1939FALSE
694.691FALSE
694.2007FALSE
694.6901FALSE
691.3013FALSE
691.2992FALSE
694.6846FALSE
691.3035FALSE
693.6565FALSE
691.3079FALSE
693.6513FALSE
693.6616FALSE
691.2947FALSE
693.6642FALSE
690.9916FALSE
693.6488FALSE
690.9897FALSE
714.3172FALSE
690.9934FALSE
714.3168FALSE
690.9933FALSE
714.3177FALSE
714.4591FALSE
690.9898FALSE
714.1756FALSE
690.2661FALSE
693.431FALSE
690.2656FALSE
693.4263FALSE
690.2666FALSE
693.4357FALSE
690.2685FALSE
690.2637FALSE
693.4468FALSE
690.1311FALSE
693.4152FALSE
691.8759FALSE
690.1308FALSE
691.8742FALSE
690.1314FALSE
691.8777FALSE
690.1326FALSE
691.8982FALSE
690.1296FALSE
691.8542FALSE
690.0328FALSE
690.488FALSE
690.0326FALSE
690.4877FALSE
690.0329FALSE
690.4883FALSE
690.0331FALSE
690.0324FALSE
690.4826FALSE
689.9982FALSE
690.4933FALSE
689.9981FALSE
690.2546FALSE
689.9983FALSE
690.2542FALSE
689.9985FALSE
690.2549FALSE
689.9979FALSE
690.0362FALSE
690.2507FALSE
690.0362FALSE
690.2585FALSE
690.0362FALSE
690.1519FALSE
690.0339FALSE
690.1517FALSE
690.0385FALSE
690.1522FALSE
689.9923FALSE
690.1543FALSE
689.9923FALSE
690.1496FALSE
689.9924FALSE
690.089FALSE
689.9922FALSE
690.0888FALSE
689.9938FALSE
690.0893FALSE
689.9863FALSE
690.0894FALSE
689.9863FALSE
690.0886FALSE
689.9864FALSE
690.0621FALSE
689.9866FALSE
690.0619FALSE
689.9871FALSE
689.9746FALSE
690.0623FALSE
689.9746FALSE
690.0625FALSE
689.9746FALSE
690.0617FALSE
689.9722FALSE
690.1101FALSE
689.977FALSE
690.1101FALSE
689.9641FALSE
690.1102FALSE
689.9641FALSE
690.1068FALSE
689.9641FALSE
690.1134FALSE
689.9643FALSE
690.0355FALSE
689.9656FALSE
690.0353FALSE
689.9627FALSE
690.0356FALSE
689.9627FALSE
690.0338FALSE
689.9627FALSE
690.0371FALSE
689.9629FALSE
690.0215FALSE
689.9624FALSE
690.0214FALSE
689.9616FALSE
689.9616FALSE
690.0217FALSE
689.9616FALSE
690.0218FALSE
689.9619FALSE
690.0212FALSE
689.993FALSE
689.9614FALSE
689.9656FALSE
689.993FALSE
689.9656FALSE
689.9931FALSE
689.9933FALSE
689.9656FALSE
689.9927FALSE
689.9637FALSE
689.9764FALSE
689.968FALSE
689.9764FALSE
689.961FALSE
689.9764FALSE
689.961FALSE
689.9767FALSE
689.961FALSE
689.9761FALSE
689.9613FALSE
689.9717FALSE
689.9608FALSE
689.9717FALSE
689.9749FALSE
689.9717FALSE
689.9749FALSE
689.97FALSE
689.9749FALSE
689.974FALSE
689.9705FALSE
689.9725FALSE
689.9705FALSE
689.9773FALSE
689.9706FALSE
689.9608FALSE
689.9708FALSE
689.9608FALSE
689.9703FALSE
689.9608FALSE
690.0014FALSE
689.961FALSE
690.0014FALSE
689.9613FALSE
690.0014FALSE
689.9601FALSE
689.9601FALSE
689.999FALSE
689.9601FALSE
690.0038FALSE
689.9603FALSE
689.9691FALSE
689.9604FALSE
689.9596FALSE
689.9691FALSE
689.9596FALSE
689.9692FALSE
689.9596FALSE
689.9692FALSE
689.9599FALSE
689.9709FALSE
689.9599FALSE
689.9662FALSE
689.9594FALSE
689.9662FALSE
689.9594FALSE
689.9663FALSE
689.9594FALSE
689.9597FALSE
689.9665FALSE
689.9596FALSE
689.9664FALSE
689.9593FALSE
689.9619FALSE
689.9593FALSE
689.9619FALSE
689.9593FALSE
689.9619FALSE
689.9596FALSE
689.9621FALSE
689.9596FALSE
689.9627FALSE
689.9593FALSE
689.9607FALSE
689.9593FALSE
689.9607FALSE
689.9593FALSE
689.9595FALSE
689.9607FALSE
689.9595FALSE
689.961FALSE
689.9592FALSE
689.9608FALSE
689.9592FALSE
689.96FALSE
689.9592FALSE
689.9599FALSE
689.96FALSE
689.9593FALSE
689.9602FALSE
689.9605FALSE
689.9602FALSE
689.9592FALSE
689.9596FALSE
689.9592FALSE
689.9596FALSE
689.9592FALSE
689.9596FALSE
689.9595FALSE
689.9598FALSE
689.9597FALSE
689.9598FALSE
689.9592FALSE
689.9597FALSE
689.9592FALSE
689.9597FALSE
689.9592FALSE
689.9595FALSE
689.9597FALSE
689.9595FALSE
689.9599FALSE
689.9592FALSE
689.9594FALSE
689.9592FALSE
689.9596FALSE
689.9596FALSE
689.9592FALSE
689.9596FALSE
689.9595FALSE
689.9599FALSE
689.9596FALSE
$par
smooth_log_cases_lag1.bw         time_ind_lag0.bw 
                5.839256                -1.600409 

$value
[1] 689.9592

$counts
function gradient 
      32       32 

$convergence
[1] 0

$message
[1] "CONVERGENCE: REL_REDUCTION_OF_F <= FACTR*EPSMCH"

689.9595FALSE
689.9596FALSE
689.9596FALSE
689.9596FALSE
689.9598FALSE
689.9597FALSE
689.9596FALSE
689.9596FALSE
689.9596FALSE
689.9598FALSE
689.9598FALSE
689.9596FALSE
689.9596FALSE
689.9596FALSE
689.9598FALSE
689.9598FALSE
689.9596FALSE
689.9596FALSE
689.9596FALSE
689.9598FALSE
689.9598FALSE
689.9596FALSE
689.9596FALSE
689.9596FALSE
689.9598FALSE
689.9598FALSE
689.9596FALSE
689.9596FALSE
689.9596FALSE
689.9598FALSE
689.9598FALSE
689.9596FALSE
689.9596FALSE
689.9596FALSE
689.9598FALSE
689.9598FALSE
689.9596FALSE
689.9596FALSE
689.9596FALSE
689.9598FALSE
689.9598FALSE
689.9596FALSE
689.9596FALSE
689.9596FALSE
689.9598FALSE
689.9598FALSE
689.9596FALSE
689.9596FALSE
689.9596FALSE
689.9598FALSE
689.9598FALSE
689.9596FALSE
689.9596FALSE
689.9596FALSE
689.9598FALSE
689.9598FALSE
689.9596FALSE
689.9596FALSE
689.9596FALSE
689.9598FALSE
689.9598FALSE
689.9596FALSE
689.9596FALSE
689.9596FALSE
689.9598FALSE
689.9598FALSE
689.9596FALSE
689.9596FALSE
689.9596FALSE
689.9598FALSE
689.9598FALSE
689.9596FALSE
689.9596FALSE
689.9596FALSE
689.9598FALSE
689.9598FALSE
689.9596FALSE
689.9596FALSE
689.9596FALSE
689.9598FALSE
689.9598FALSE
689.9596FALSE
689.9596FALSE
689.9596FALSE
689.9598FALSE
689.9598FALSE
689.9596FALSE
689.9596FALSE
689.9596FALSE
689.9598FALSE
689.9598FALSE
$par
smooth_log_cases_lag0.bw         time_ind_lag0.bw 
                4.642620                -1.600327 

$value
[1] 689.9596

$counts
function gradient 
      49       49 

$convergence
[1] 0

$message
[1] "CONVERGENCE: REL_REDUCTION_OF_F <= FACTR*EPSMCH"

> 
> save(ssr_fit,
+     file=paste0("/home/ngr67a/2015-cdc-flu-competition/fit-competition-ssr-ph", prediction_horizon_limit, "-", data_set, ".Rdata"))
> 
> proc.time()
    user   system  elapsed 
1095.418    0.811 1145.976 
