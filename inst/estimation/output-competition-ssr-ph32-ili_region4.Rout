
R version 3.2.2 (2015-08-14) -- "Fire Safety"
Copyright (C) 2015 The R Foundation for Statistical Computing
Platform: x86_64-pc-linux-gnu (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

  Natural language support but running in an English locale

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> ### get ssr fit -- prediction horizons 1:52
> library(lubridate)
> library(ggplot2)
> library(plyr)

Attaching package: ‘plyr’

The following object is masked from ‘package:lubridate’:

    here

> library(dplyr)

Attaching package: ‘dplyr’

The following objects are masked from ‘package:plyr’:

    arrange, count, desc, failwith, id, mutate, rename, summarise,
    summarize

The following objects are masked from ‘package:lubridate’:

    intersect, setdiff, union

The following objects are masked from ‘package:stats’:

    filter, lag

The following objects are masked from ‘package:base’:

    intersect, setdiff, setequal, union

> library(reshape)

Attaching package: ‘reshape’

The following object is masked from ‘package:dplyr’:

    rename

The following objects are masked from ‘package:plyr’:

    rename, round_any

The following object is masked from ‘package:lubridate’:

    stamp

> library(ssrFlu)
> library(doMC)
Loading required package: foreach
Loading required package: iterators
Loading required package: parallel
> 
> registerDoMC(cores=3)
> 
> args <- commandArgs(trailingOnly=TRUE)
> 
> data_set <- args[1]
> prediction_horizon_limit <- as.integer(args[2])
> 
> ## load dataset
> if(identical(data_set, "ili_national")) {
+     data <- ili_national
+ } 
> if(identical(data_set, "ili_region1")) {
+     data <- ili_region1
+ } 
> if(identical(data_set, "ili_region2")) {
+     data <- ili_region2
+ } 
> if(identical(data_set, "ili_region3")) {
+     data <- ili_region3
+ } 
> if(identical(data_set, "ili_region4")) {
+     data <- ili_region4
+ } 
> if(identical(data_set, "ili_region5")) {
+     data <- ili_region5
+ } 
> if(identical(data_set, "ili_region6")) {
+     data <- ili_region6
+ } 
> if(identical(data_set, "ili_region7")) {
+     data <- ili_region7
+ } 
> if(identical(data_set, "ili_region8")) {
+     data <- ili_region8
+ } 
> if(identical(data_set, "ili_region9")) {
+     data <- ili_region9
+ } 
> if(identical(data_set, "ili_region10")) {
+     data <- ili_region10
+ } 
> 
> 
> 
> ## add log column
> data$log_total_cases <- log(data$total_cases + 1)
> 
> ## add week_start_date
> char_dates <- paste(data$year, data$week, "1")
> data$week_start_date <- as.Date(char_dates, format="%Y %W %w")
> 
> ## remove week 53s
> data <- data[-which(is.na(data$week_start_date)),]
> data <- data[262:nrow(data),]
> 
> ## add smooth log column -- or not, since it is already pretty smooth...
> sm <- loess(log_total_cases ~ as.numeric(week_start_date), data=data, span= 26 / nrow(data))
> data$smooth_log_cases <- sm$fitted
> 
> ## add time column
> data$time_ind <- seq_len(nrow(data))
> 
> ssr_control <- create_ssr_control(X_names=c("smooth_log_cases", "time_ind"),
+     y_names="total_cases",
+     time_name=NULL,
+     max_lag=list(smooth_log_cases=1,
+         time_ind=0),
+     prediction_horizons=as.integer(prediction_horizon_limit),
+     kernel_fns=list(smooth_log_cases="squared_exp_kernel",
+         time_ind="periodic_kernel"),
+     theta_est=list(smooth_log_cases="bw",
+         time_ind="bw"),
+     theta_fixed=list(time_ind=list(period=pi / 52)),
+     theta_transform_fns=list(
+         squared_exp_kernel=list(
+             bw=list(transform="log",
+                 detransform="exp")
+         ),
+         periodic_kernel=list(
+             bw=list(transform="log",
+                 detransform="exp")
+         )
+     ),
+     crossval_buffer=52,
+     loss_fn_name="mae_from_kernel_weights_and_centers",
+     loss_fn_args=list())
> 
> 
> ssr_fit <- ssr(X_names=c("smooth_log_cases", "time_ind"),
+     y_names="total_cases",
+     time_name=NULL,
+     data=data,
+     ssr_control=ssr_control)
539.3621FALSE
531.0962FALSE
388.2153FALSE
539.3572FALSE
388.2137FALSE
531.0905FALSE
539.3669FALSE
388.217FALSE
531.1018FALSE
539.567FALSE
396.0545FALSE
530.7417FALSE
539.5755FALSE
396.0838FALSE
530.7519FALSE
539.5585FALSE
396.0252FALSE
538.3611FALSE
388.0657FALSE
530.7314FALSE
538.3612FALSE
388.0662FALSE
538.361FALSE
388.0651FALSE
529.7455FALSE
538.3587FALSE
538.3589FALSE
388.0692FALSE
529.7446FALSE
538.3584FALSE
388.069FALSE
529.7465FALSE
538.3717FALSE
388.0694FALSE
529.6529FALSE
529.6514FALSE
538.3709FALSE
388.0622FALSE
529.6543FALSE
538.3725FALSE
388.0623FALSE
529.3355FALSE
538.3546FALSE
388.0621FALSE
538.3549FALSE
529.3358FALSE
388.0622FALSE
538.3542FALSE
529.3353FALSE
388.0621FALSE
538.3522FALSE
529.366FALSE
388.0625FALSE
538.3526FALSE
529.3654FALSE
388.0621FALSE
538.3517FALSE
529.3667FALSE
388.0622FALSE
529.3344FALSE
388.0621FALSE
538.351FALSE
529.3341FALSE
388.0621FALSE
538.3508FALSE
529.3347FALSE
538.3513FALSE
388.0622FALSE
529.3348FALSE
538.3511FALSE
388.0622FALSE
529.335FALSE
538.3515FALSE
388.0621FALSE
529.3346FALSE
538.3508FALSE
388.0622FALSE
529.3428FALSE
538.351FALSE
388.0621FALSE
529.3423FALSE
538.3508FALSE
388.0621FALSE
538.3513FALSE
529.3432FALSE
538.3588FALSE
388.0622FALSE
529.3341FALSE
538.359FALSE
388.0622FALSE
529.3343FALSE
529.3343FALSE
388.0621FALSE
538.3585FALSE
529.3341FALSE
388.0622FALSE
529.3342FALSE
538.3516FALSE
388.0622FALSE
529.3344FALSE
388.0621FALSE
538.352FALSE
529.3341FALSE
388.0622FALSE
529.3343FALSE
538.3512FALSE
388.0622FALSE
529.3343FALSE
388.0621FALSE
538.3508FALSE
529.3341FALSE
388.0622FALSE
538.3511FALSE
529.3343FALSE
538.3511FALSE
388.0622FALSE
529.3343FALSE
538.3507FALSE
388.0621FALSE
529.3341FALSE
538.3511FALSE
388.0622FALSE
529.3343FALSE
538.3511FALSE
388.0622FALSE
529.3343FALSE
538.3507FALSE
388.0621FALSE
529.3341FALSE
538.3511FALSE
388.0622FALSE
529.3343FALSE
538.3511FALSE
388.0622FALSE
529.3343FALSE
538.3507FALSE
388.0621FALSE
538.3511FALSE
529.3341FALSE
388.0622FALSE
538.3511FALSE
529.3343FALSE
388.0622FALSE
538.3507FALSE
529.3343FALSE
388.0621FALSE
538.3511FALSE
529.3341FALSE
388.0622FALSE
538.3511FALSE
529.3343FALSE
388.0622FALSE
538.3507FALSE
529.3343FALSE
388.0621FALSE
538.3511FALSE
529.3341FALSE
388.0622FALSE
538.3511FALSE
529.3343FALSE
388.0622FALSE
529.3343FALSE
538.3507FALSE
529.3341FALSE
388.0621FALSE
529.3343FALSE
538.3511FALSE
529.3343FALSE
388.0622FALSE
538.3511FALSE
529.3341FALSE
388.0622FALSE
529.3343FALSE
388.0621FALSE
538.3507FALSE
529.3343FALSE
388.0622FALSE
538.3511FALSE
529.3341FALSE
388.0622FALSE
538.3511FALSE
529.3343FALSE
388.0621FALSE
538.3507FALSE
529.3343FALSE
388.0622FALSE
538.3511FALSE
529.3341FALSE
388.0622FALSE
538.3511FALSE
529.3343FALSE
388.0621FALSE
538.3507FALSE
529.3343FALSE
388.0622FALSE
529.3341FALSE
538.3511FALSE
388.0622FALSE
529.3343FALSE
538.3511FALSE
388.0621FALSE
529.3343FALSE
538.3507FALSE
388.0622FALSE
529.3341FALSE
538.3511FALSE
388.0622FALSE
529.3343FALSE
538.3511FALSE
388.0621FALSE
529.3343FALSE
538.3507FALSE
388.0622FALSE
529.3341FALSE
538.3511FALSE
529.3343FALSE
388.0622FALSE
538.3511FALSE
529.3343FALSE
388.0621FALSE
538.3507FALSE
529.3341FALSE
388.0622FALSE
538.3511FALSE
529.3343FALSE
388.0622FALSE
538.3511FALSE
529.3343FALSE
$par
smooth_log_cases_lag0.bw 
                -1.59648 

$value
[1] 529.3341

$counts
function gradient 
      26       26 

$convergence
[1] 0

$message
[1] "CONVERGENCE: REL_REDUCTION_OF_F <= FACTR*EPSMCH"

388.0621FALSE
538.3507FALSE
388.0622FALSE
538.3511FALSE
388.0622FALSE
538.3511FALSE
388.0621FALSE
538.3507FALSE
388.0622FALSE
388.0622FALSE
538.3511FALSE
388.0621FALSE
388.0622FALSE
538.3511FALSE
388.0622FALSE
$par
time_ind_lag0.bw 
        -2.12768 

$value
[1] 388.0621

$counts
function gradient 
      28       28 

$convergence
[1] 0

$message
[1] "CONVERGENCE: REL_REDUCTION_OF_F <= FACTR*EPSMCH"

538.3507FALSE
538.3511FALSE
538.3511FALSE
538.3507FALSE
538.3511FALSE
538.3511FALSE
538.3507FALSE
538.3511FALSE
538.3511FALSE
538.3507FALSE
538.3511FALSE
538.3511FALSE
538.3507FALSE
538.3511FALSE
538.3511FALSE
538.3507FALSE
538.3511FALSE
538.3511FALSE
538.3507FALSE
538.3511FALSE
538.3511FALSE
538.3507FALSE
538.3511FALSE
538.3511FALSE
538.3507FALSE
538.3511FALSE
538.3511FALSE
538.3507FALSE
538.3511FALSE
538.3511FALSE
538.3507FALSE
538.3511FALSE
538.3511FALSE
538.3507FALSE
538.3511FALSE
538.3511FALSE
538.3507FALSE
538.3511FALSE
538.3511FALSE
538.3507FALSE
538.3511FALSE
538.3511FALSE
538.3507FALSE
538.3511FALSE
538.3511FALSE
538.3507FALSE
538.3511FALSE
538.3511FALSE
538.3507FALSE
538.3511FALSE
538.3511FALSE
538.3507FALSE
538.3511FALSE
538.3511FALSE
538.3507FALSE
538.3511FALSE
538.3511FALSE
538.3507FALSE
538.3511FALSE
538.3511FALSE
538.3507FALSE
538.3511FALSE
538.3511FALSE
538.3507FALSE
538.3511FALSE
538.3511FALSE
538.3507FALSE
538.3511FALSE
538.3511FALSE
538.3507FALSE
538.3511FALSE
538.3511FALSE
538.3507FALSE
538.3511FALSE
538.3511FALSE
538.3507FALSE
538.3511FALSE
538.3511FALSE
538.3507FALSE
538.3511FALSE
538.3511FALSE
$par
smooth_log_cases_lag1.bw 
               -1.828153 

$value
[1] 538.3507

$counts
function gradient 
      54       54 

$convergence
[1] 52

$message
[1] "ERROR: ABNORMAL_TERMINATION_IN_LNSRCH"

414.8576FALSE
412.0723FALSE
414.8496FALSE
414.8656FALSE
412.0655FALSE
414.8696FALSE
414.8457FALSE
412.0791FALSE
401.1255FALSE
401.1099FALSE
412.0821FALSE
401.1411FALSE
401.1255FALSE
412.0625FALSE
401.1256FALSE
394.9281FALSE
399.9939FALSE
394.9281FALSE
394.9282FALSE
399.9808FALSE
394.9281FALSE
394.9281FALSE
400.007FALSE
394.9281FALSE
399.9938FALSE
394.9281FALSE
394.9281FALSE
399.994FALSE
394.9281FALSE
394.9281FALSE
394.912FALSE
394.9281FALSE
394.9281FALSE
394.912FALSE
394.9281FALSE
394.9281FALSE
394.912FALSE
394.9281FALSE
394.9281FALSE
394.912FALSE
394.9281FALSE
394.912FALSE
394.9281FALSE
394.9118FALSE
394.9281FALSE
394.9118FALSE
394.9281FALSE
394.9118FALSE
394.9279FALSE
394.9118FALSE
394.9279FALSE
394.9118FALSE
394.9279FALSE
394.9111FALSE
394.9279FALSE
394.9111FALSE
394.9279FALSE
394.911FALSE
394.9272FALSE
394.9111FALSE
394.9272FALSE
394.9111FALSE
394.9272FALSE
394.9078FALSE
394.9272FALSE
394.9078FALSE
394.9272FALSE
394.9077FALSE
394.927FALSE
394.9078FALSE
394.9078FALSE
394.927FALSE
394.8871FALSE
394.927FALSE
394.8871FALSE
394.927FALSE
394.887FALSE
394.927FALSE
394.8871FALSE
394.9269FALSE
394.8871FALSE
394.9269FALSE
394.4149FALSE
394.9269FALSE
394.4098FALSE
394.9269FALSE
394.4201FALSE
394.9269FALSE
394.41FALSE
394.9268FALSE
394.4199FALSE
394.9268FALSE
394.8763FALSE
394.9268FALSE
394.8764FALSE
394.9268FALSE
394.8762FALSE
394.9268FALSE
394.8763FALSE
394.9267FALSE
394.8763FALSE
394.9267FALSE
394.7041FALSE
394.9267FALSE
394.7026FALSE
394.9267FALSE
394.7056FALSE
394.9267FALSE
394.701FALSE
394.9267FALSE
394.7072FALSE
394.9267FALSE
394.4072FALSE
394.9267FALSE
394.4028FALSE
394.9267FALSE
394.4117FALSE
394.4025FALSE
394.9267FALSE
394.412FALSE
394.9267FALSE
394.4052FALSE
394.4008FALSE
394.9267FALSE
394.4095FALSE
394.4005FALSE
394.9267FALSE
394.41FALSE
394.9267FALSE
394.5258FALSE
394.9267FALSE
394.5233FALSE
394.9267FALSE
394.5282FALSE
394.9267FALSE
394.5208FALSE
394.9267FALSE
394.5307FALSE
394.9267FALSE
394.4052FALSE
394.9267FALSE
394.4008FALSE
394.9267FALSE
394.4095FALSE
394.9267FALSE
394.4005FALSE
394.9267FALSE
394.9267FALSE
394.41FALSE
394.9267FALSE
394.8445FALSE
394.9267FALSE
394.8446FALSE
394.9267FALSE
394.8444FALSE
394.9267FALSE
394.9267FALSE
394.8445FALSE
394.9267FALSE
394.9267FALSE
394.8445FALSE
394.9267FALSE
394.9267FALSE
394.4622FALSE
394.9267FALSE
394.9267FALSE
394.4595FALSE
394.9267FALSE
394.9267FALSE
394.4649FALSE
394.9267FALSE
394.9267FALSE
394.4579FALSE
394.9267FALSE
$par
smooth_log_cases_lag0.bw         time_ind_lag0.bw 
                4.557597                -8.585280 

$value
[1] 394.9267

$counts
function gradient 
      19       19 

$convergence
[1] 0

$message
[1] "CONVERGENCE: REL_REDUCTION_OF_F <= FACTR*EPSMCH"

394.4665FALSE
394.405FALSE
394.4008FALSE
394.4092FALSE
394.4001FALSE
394.4098FALSE
392.2238FALSE
392.2227FALSE
392.2249FALSE
392.2189FALSE
392.2287FALSE
388.8776FALSE
388.876FALSE
388.8792FALSE
388.8799FALSE
388.8754FALSE
388.9064FALSE
388.9052FALSE
388.9075FALSE
388.9057FALSE
388.907FALSE
388.7817FALSE
388.7802FALSE
388.7832FALSE
388.7823FALSE
388.7811FALSE
388.6868FALSE
388.6856FALSE
388.688FALSE
388.6872FALSE
388.6864FALSE
388.4391FALSE
388.4384FALSE
388.4397FALSE
388.4381FALSE
388.44FALSE
388.18FALSE
388.1798FALSE
388.1802FALSE
388.1806FALSE
388.1793FALSE
388.1411FALSE
388.141FALSE
388.1413FALSE
388.1418FALSE
388.1405FALSE
388.1016FALSE
388.1015FALSE
388.1017FALSE
388.1012FALSE
388.102FALSE
388.0899FALSE
388.0899FALSE
388.09FALSE
388.0898FALSE
388.0901FALSE
388.0766FALSE
388.0766FALSE
388.0766FALSE
388.0764FALSE
388.0768FALSE
388.0667FALSE
388.0667FALSE
388.0667FALSE
388.0668FALSE
388.0666FALSE
388.0659FALSE
388.0659FALSE
388.0659FALSE
388.0663FALSE
388.0658FALSE
388.063FALSE
388.063FALSE
388.063FALSE
388.0627FALSE
388.0633FALSE
388.0623FALSE
388.0623FALSE
388.0623FALSE
388.0624FALSE
388.0623FALSE
388.0622FALSE
388.0622FALSE
388.0622FALSE
388.0623FALSE
388.0625FALSE
388.0622FALSE
388.0622FALSE
388.0622FALSE
388.0623FALSE
388.0624FALSE
388.0622FALSE
388.0622FALSE
388.0622FALSE
388.0623FALSE
388.0624FALSE
388.0622FALSE
388.0622FALSE
388.0622FALSE
388.0623FALSE
388.0625FALSE
388.0622FALSE
388.0622FALSE
388.0622FALSE
388.0623FALSE
388.0625FALSE
388.0622FALSE
388.0622FALSE
388.0622FALSE
388.0623FALSE
388.0625FALSE
388.0622FALSE
388.0622FALSE
388.0622FALSE
388.0623FALSE
388.0625FALSE
388.0622FALSE
388.0622FALSE
388.0622FALSE
388.0623FALSE
388.0625FALSE
388.0622FALSE
388.0622FALSE
388.0622FALSE
388.0623FALSE
388.0625FALSE
388.0622FALSE
388.0622FALSE
388.0622FALSE
388.0623FALSE
388.0625FALSE
388.0622FALSE
388.0622FALSE
388.0622FALSE
388.0623FALSE
388.0625FALSE
388.0622FALSE
388.0622FALSE
388.0622FALSE
388.0623FALSE
388.0625FALSE
388.0622FALSE
388.0622FALSE
388.0622FALSE
388.0623FALSE
388.0625FALSE
388.0622FALSE
388.0622FALSE
388.0622FALSE
388.0623FALSE
388.0625FALSE
388.0622FALSE
388.0622FALSE
388.0622FALSE
388.0623FALSE
388.0625FALSE
388.0622FALSE
388.0622FALSE
388.0622FALSE
388.0623FALSE
388.0625FALSE
388.0622FALSE
388.0622FALSE
388.0622FALSE
388.0623FALSE
388.0625FALSE
388.0622FALSE
388.0622FALSE
388.0622FALSE
388.0623FALSE
388.0625FALSE
388.0622FALSE
388.0622FALSE
388.0622FALSE
388.0623FALSE
388.0625FALSE
388.0622FALSE
388.0622FALSE
388.0622FALSE
388.0623FALSE
388.0625FALSE
388.0622FALSE
388.0622FALSE
388.0622FALSE
388.0623FALSE
388.0625FALSE
388.1362FALSE
388.1362FALSE
388.1362FALSE
388.1376FALSE
388.1348FALSE
388.0625FALSE
388.0625FALSE
388.0625FALSE
388.0626FALSE
388.0624FALSE
388.0622FALSE
388.0622FALSE
388.0622FALSE
388.0623FALSE
388.0623FALSE
388.0622FALSE
388.0622FALSE
388.0622FALSE
388.0623FALSE
388.0624FALSE
388.0622FALSE
388.0622FALSE
388.0622FALSE
388.0623FALSE
388.0625FALSE
388.0622FALSE
388.0622FALSE
388.0622FALSE
388.0623FALSE
388.0625FALSE
388.0622FALSE
388.0622FALSE
388.0622FALSE
388.0623FALSE
388.0625FALSE
388.0622FALSE
388.0622FALSE
388.0622FALSE
388.0623FALSE
388.0625FALSE
388.0622FALSE
388.0622FALSE
388.0622FALSE
388.0623FALSE
388.0625FALSE
388.0622FALSE
388.0622FALSE
388.0622FALSE
388.0623FALSE
388.0625FALSE
388.0622FALSE
388.0622FALSE
388.0622FALSE
388.0623FALSE
388.0625FALSE
388.0622FALSE
388.0622FALSE
388.0622FALSE
388.0623FALSE
388.0625FALSE
388.0622FALSE
388.0622FALSE
388.0622FALSE
388.0623FALSE
388.0625FALSE
388.0622FALSE
388.0622FALSE
388.0622FALSE
388.0623FALSE
388.0625FALSE
388.0622FALSE
388.0622FALSE
388.0622FALSE
388.0623FALSE
388.0625FALSE
388.0622FALSE
388.0622FALSE
388.0622FALSE
388.0623FALSE
388.0625FALSE
388.0622FALSE
388.0622FALSE
388.0622FALSE
388.0623FALSE
388.0625FALSE
388.0622FALSE
388.0622FALSE
388.0622FALSE
388.0623FALSE
388.0625FALSE
388.0622FALSE
388.0622FALSE
388.0622FALSE
388.0623FALSE
388.0625FALSE
$par
smooth_log_cases_lag1.bw         time_ind_lag0.bw 
                4.122079                -2.128070 

$value
[1] 388.0622

$counts
function gradient 
      72       72 

$convergence
[1] 0

$message
[1] "CONVERGENCE: REL_REDUCTION_OF_F <= FACTR*EPSMCH"

> 
> save(ssr_fit,
+     file=paste0("/home/ngr67a/2015-cdc-flu-competition/fit-competition-ssr-ph", prediction_horizon_limit, "-", data_set, ".Rdata"))
> 
> proc.time()
    user   system  elapsed 
 863.717    0.421 1188.525 
