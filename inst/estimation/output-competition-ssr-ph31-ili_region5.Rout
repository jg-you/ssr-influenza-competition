
R version 3.2.2 (2015-08-14) -- "Fire Safety"
Copyright (C) 2015 The R Foundation for Statistical Computing
Platform: x86_64-pc-linux-gnu (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

  Natural language support but running in an English locale

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> ### get ssr fit -- prediction horizons 1:52
> library(lubridate)
> library(ggplot2)
> library(plyr)

Attaching package: ‘plyr’

The following object is masked from ‘package:lubridate’:

    here

> library(dplyr)

Attaching package: ‘dplyr’

The following objects are masked from ‘package:plyr’:

    arrange, count, desc, failwith, id, mutate, rename, summarise,
    summarize

The following objects are masked from ‘package:lubridate’:

    intersect, setdiff, union

The following objects are masked from ‘package:stats’:

    filter, lag

The following objects are masked from ‘package:base’:

    intersect, setdiff, setequal, union

> library(reshape)

Attaching package: ‘reshape’

The following object is masked from ‘package:dplyr’:

    rename

The following objects are masked from ‘package:plyr’:

    rename, round_any

The following object is masked from ‘package:lubridate’:

    stamp

> library(ssrFlu)
> library(doMC)
Loading required package: foreach
Loading required package: iterators
Loading required package: parallel
> 
> registerDoMC(cores=3)
> 
> args <- commandArgs(trailingOnly=TRUE)
> 
> data_set <- args[1]
> prediction_horizon_limit <- as.integer(args[2])
> 
> ## load dataset
> if(identical(data_set, "ili_national")) {
+     data <- ili_national
+ } 
> if(identical(data_set, "ili_region1")) {
+     data <- ili_region1
+ } 
> if(identical(data_set, "ili_region2")) {
+     data <- ili_region2
+ } 
> if(identical(data_set, "ili_region3")) {
+     data <- ili_region3
+ } 
> if(identical(data_set, "ili_region4")) {
+     data <- ili_region4
+ } 
> if(identical(data_set, "ili_region5")) {
+     data <- ili_region5
+ } 
> if(identical(data_set, "ili_region6")) {
+     data <- ili_region6
+ } 
> if(identical(data_set, "ili_region7")) {
+     data <- ili_region7
+ } 
> if(identical(data_set, "ili_region8")) {
+     data <- ili_region8
+ } 
> if(identical(data_set, "ili_region9")) {
+     data <- ili_region9
+ } 
> if(identical(data_set, "ili_region10")) {
+     data <- ili_region10
+ } 
> 
> 
> 
> ## add log column
> data$log_total_cases <- log(data$total_cases + 1)
> 
> ## add week_start_date
> char_dates <- paste(data$year, data$week, "1")
> data$week_start_date <- as.Date(char_dates, format="%Y %W %w")
> 
> ## remove week 53s
> data <- data[-which(is.na(data$week_start_date)),]
> data <- data[262:nrow(data),]
> 
> ## add smooth log column -- or not, since it is already pretty smooth...
> sm <- loess(log_total_cases ~ as.numeric(week_start_date), data=data, span= 26 / nrow(data))
> data$smooth_log_cases <- sm$fitted
> 
> ## add time column
> data$time_ind <- seq_len(nrow(data))
> 
> ssr_control <- create_ssr_control(X_names=c("smooth_log_cases", "time_ind"),
+     y_names="total_cases",
+     time_name=NULL,
+     max_lag=list(smooth_log_cases=1,
+         time_ind=0),
+     prediction_horizons=as.integer(prediction_horizon_limit),
+     kernel_fns=list(smooth_log_cases="squared_exp_kernel",
+         time_ind="periodic_kernel"),
+     theta_est=list(smooth_log_cases="bw",
+         time_ind="bw"),
+     theta_fixed=list(time_ind=list(period=pi / 52)),
+     theta_transform_fns=list(
+         squared_exp_kernel=list(
+             bw=list(transform="log",
+                 detransform="exp")
+         ),
+         periodic_kernel=list(
+             bw=list(transform="log",
+                 detransform="exp")
+         )
+     ),
+     crossval_buffer=52,
+     loss_fn_name="mae_from_kernel_weights_and_centers",
+     loss_fn_args=list())
> 
> 
> ssr_fit <- ssr(X_names=c("smooth_log_cases", "time_ind"),
+     y_names="total_cases",
+     time_name=NULL,
+     data=data,
+     ssr_control=ssr_control)
353.2553FALSE
431.0253FALSE
451.0332FALSE
431.0255FALSE
353.2456FALSE
451.0317FALSE
431.0252FALSE
353.265FALSE
451.0348FALSE
440.3127FALSE
352.1405FALSE
440.3088FALSE
461.2002FALSE
352.1662FALSE
440.3164FALSE
461.2265FALSE
352.1148FALSE
431.0251FALSE
461.1739FALSE
350.9631FALSE
431.0252FALSE
450.9552FALSE
350.9555FALSE
431.025FALSE
350.971FALSE
450.9549FALSE
431.0248FALSE
379.3147FALSE
450.9556FALSE
431.0248FALSE
379.4409FALSE
450.9489FALSE
431.0248FALSE
379.1887FALSE
450.9487FALSE
431.0248FALSE
349.1121FALSE
431.0248FALSE
450.9492FALSE
349.1078FALSE
431.0248FALSE
$par
smooth_log_cases_lag0.bw 
               -2.311587 

$value
[1] 431.0248

$counts
function gradient 
       5        5 

$convergence
[1] 0

$message
[1] "CONVERGENCE: REL_REDUCTION_OF_F <= FACTR*EPSMCH"

451.0624FALSE
349.1165FALSE
451.066FALSE
351.3089FALSE
451.0589FALSE
351.3324FALSE
450.9474FALSE
351.2854FALSE
450.9472FALSE
348.7713FALSE
450.9476FALSE
348.7696FALSE
450.9511FALSE
348.773FALSE
450.9519FALSE
348.7959FALSE
450.9502FALSE
348.7998FALSE
450.9455FALSE
348.7919FALSE
450.9453FALSE
348.7473FALSE
450.9457FALSE
348.7472FALSE
451.1362FALSE
348.7473FALSE
451.1398FALSE
348.7472FALSE
451.1327FALSE
348.7471FALSE
450.9455FALSE
348.7472FALSE
450.9459FALSE
348.7479FALSE
450.9453FALSE
348.7482FALSE
450.9454FALSE
348.7476FALSE
450.9454FALSE
348.7472FALSE
450.9455FALSE
348.7471FALSE
450.9453FALSE
348.7472FALSE
450.9456FALSE
348.7475FALSE
450.9455FALSE
348.7478FALSE
450.9453FALSE
348.7472FALSE
450.9455FALSE
348.7471FALSE
450.9455FALSE
348.7471FALSE
450.9453FALSE
348.7472FALSE
450.9456FALSE
348.7477FALSE
450.9455FALSE
348.748FALSE
450.9453FALSE
348.7475FALSE
450.9456FALSE
348.7471FALSE
450.9455FALSE
348.7472FALSE
450.9453FALSE
348.7472FALSE
450.9456FALSE
348.7471FALSE
450.9455FALSE
348.7472FALSE
450.9453FALSE
348.7472FALSE
450.9456FALSE
348.7471FALSE
450.9455FALSE
348.7472FALSE
450.9453FALSE
348.7472FALSE
450.9456FALSE
348.7471FALSE
450.9455FALSE
348.7472FALSE
450.9453FALSE
348.7472FALSE
450.9456FALSE
348.7471FALSE
450.9455FALSE
348.7472FALSE
450.9453FALSE
348.7472FALSE
450.9456FALSE
348.7471FALSE
450.9455FALSE
348.7472FALSE
450.9453FALSE
348.7472FALSE
450.9456FALSE
348.7471FALSE
450.9455FALSE
348.7472FALSE
450.9453FALSE
348.7472FALSE
450.9456FALSE
348.7471FALSE
450.9455FALSE
348.7472FALSE
450.9453FALSE
348.7472FALSE
450.9456FALSE
348.7471FALSE
450.9455FALSE
348.7472FALSE
450.9453FALSE
348.7472FALSE
450.9456FALSE
348.7471FALSE
450.9455FALSE
348.7472FALSE
450.9453FALSE
348.7472FALSE
450.9456FALSE
348.7471FALSE
450.9455FALSE
348.7472FALSE
450.9453FALSE
348.7472FALSE
450.9456FALSE
348.7471FALSE
450.9455FALSE
348.7472FALSE
450.9453FALSE
348.7472FALSE
450.9456FALSE
450.9455FALSE
348.7471FALSE
450.9453FALSE
348.7472FALSE
450.9456FALSE
348.7472FALSE
450.9455FALSE
348.7471FALSE
450.9453FALSE
348.7472FALSE
348.7472FALSE
450.9456FALSE
348.7471FALSE
450.9455FALSE
$par
smooth_log_cases_lag1.bw 
               -2.179997 

$value
[1] 450.9453

$counts
function gradient 
      29       29 

$convergence
[1] 0

$message
[1] "CONVERGENCE: REL_REDUCTION_OF_F <= FACTR*EPSMCH"

348.7472FALSE
348.7472FALSE
348.7471FALSE
348.7472FALSE
348.7472FALSE
348.7471FALSE
348.7472FALSE
348.7472FALSE
348.7471FALSE
348.7472FALSE
348.7472FALSE
348.7471FALSE
348.7472FALSE
348.7472FALSE
348.7471FALSE
348.7472FALSE
348.7472FALSE
348.7471FALSE
348.7472FALSE
348.7472FALSE
348.7471FALSE
348.7472FALSE
348.7472FALSE
348.7471FALSE
348.7472FALSE
348.7472FALSE
348.7471FALSE
348.7472FALSE
348.7472FALSE
348.7471FALSE
348.7472FALSE
348.7472FALSE
348.7471FALSE
348.7472FALSE
348.7472FALSE
348.7471FALSE
348.7472FALSE
348.7472FALSE
348.7471FALSE
348.7472FALSE
348.7472FALSE
348.7471FALSE
348.7472FALSE
348.7472FALSE
348.7471FALSE
348.7472FALSE
348.7472FALSE
348.7471FALSE
348.7472FALSE
348.7472FALSE
348.7471FALSE
348.7472FALSE
348.7472FALSE
348.7471FALSE
348.7472FALSE
348.7472FALSE
348.7471FALSE
348.7472FALSE
348.7472FALSE
348.7471FALSE
348.7472FALSE
348.7472FALSE
348.7471FALSE
348.7472FALSE
348.7472FALSE
348.7471FALSE
348.7472FALSE
348.7472FALSE
348.7471FALSE
348.7472FALSE
348.7472FALSE
348.7471FALSE
348.7472FALSE
348.7472FALSE
348.7471FALSE
348.7472FALSE
348.7472FALSE
348.7471FALSE
348.7472FALSE
348.7472FALSE
348.7471FALSE
348.7472FALSE
348.7472FALSE
$par
time_ind_lag0.bw 
       -1.579475 

$value
[1] 348.7471

$counts
function gradient 
      57       57 

$convergence
[1] 52

$message
[1] "ERROR: ABNORMAL_TERMINATION_IN_LNSRCH"

366.3945FALSE
369.5513FALSE
366.3815FALSE
369.5368FALSE
366.4075FALSE
369.5658FALSE
366.3947FALSE
369.5539FALSE
369.5489FALSE
366.3942FALSE
357.3659FALSE
354.9474FALSE
357.3565FALSE
354.9409FALSE
357.3753FALSE
354.9539FALSE
357.3568FALSE
354.9433FALSE
357.3751FALSE
354.9515FALSE
354.6361FALSE
401.2745FALSE
354.6361FALSE
354.6362FALSE
401.2813FALSE
354.6728FALSE
401.2677FALSE
354.5995FALSE
401.4144FALSE
348.8921FALSE
401.1346FALSE
348.892FALSE
353.3112FALSE
348.8923FALSE
353.3057FALSE
348.8901FALSE
353.3168FALSE
348.8942FALSE
353.3121FALSE
348.8452FALSE
353.3104FALSE
348.8451FALSE
350.6158FALSE
348.8453FALSE
350.6142FALSE
348.8434FALSE
350.6174FALSE
348.847FALSE
350.6254FALSE
349.3034FALSE
350.6071FALSE
349.3034FALSE
349.1899FALSE
349.3035FALSE
349.1892FALSE
349.313FALSE
349.1905FALSE
349.2939FALSE
349.1871FALSE
348.8101FALSE
349.1926FALSE
348.81FALSE
349.0532FALSE
349.0527FALSE
348.8102FALSE
349.0536FALSE
348.81FALSE
349.0509FALSE
348.8102FALSE
349.0554FALSE
348.8034FALSE
348.8897FALSE
348.8033FALSE
348.8895FALSE
348.8035FALSE
348.8899FALSE
348.8036FALSE
348.8921FALSE
348.8032FALSE
348.8874FALSE
348.7914FALSE
348.8368FALSE
348.7913FALSE
348.8367FALSE
348.7915FALSE
348.837FALSE
348.7917FALSE
348.8367FALSE
348.7912FALSE
348.837FALSE
348.7768FALSE
348.7994FALSE
348.7768FALSE
348.7993FALSE
348.7768FALSE
348.7995FALSE
348.7781FALSE
348.7993FALSE
348.7757FALSE
348.7624FALSE
348.7995FALSE
348.7717FALSE
348.7623FALSE
348.7717FALSE
348.7624FALSE
348.7718FALSE
348.7627FALSE
348.7621FALSE
348.7716FALSE
348.7718FALSE
348.7555FALSE
348.7598FALSE
348.7555FALSE
348.7598FALSE
348.7555FALSE
348.7598FALSE
348.7558FALSE
348.7597FALSE
348.7552FALSE
348.7599FALSE
348.7511FALSE
348.7532FALSE
348.7511FALSE
348.7531FALSE
348.7511FALSE
348.7532FALSE
348.751FALSE
348.7534FALSE
348.7516FALSE
348.7532FALSE
348.7503FALSE
348.7509FALSE
348.7503FALSE
348.7509FALSE
348.7503FALSE
348.7509FALSE
348.7502FALSE
348.7512FALSE
348.7504FALSE
348.7506FALSE
348.7495FALSE
348.7488FALSE
348.7494FALSE
348.7488FALSE
348.7495FALSE
348.7488FALSE
348.7494FALSE
348.7487FALSE
348.7495FALSE
348.7493FALSE
348.7511FALSE
348.7485FALSE
348.7511FALSE
348.7485FALSE
348.7511FALSE
348.7485FALSE
348.7514FALSE
348.7484FALSE
348.7508FALSE
348.7485FALSE
348.7488FALSE
348.7483FALSE
348.7488FALSE
348.7483FALSE
348.7488FALSE
348.7483FALSE
348.7487FALSE
348.7482FALSE
348.7488FALSE
348.7483FALSE
348.7561FALSE
348.7476FALSE
348.7561FALSE
348.7476FALSE
348.7561FALSE
348.7476FALSE
348.7574FALSE
348.7475FALSE
348.755FALSE
348.7476FALSE
348.7491FALSE
348.7511FALSE
348.7491FALSE
348.7511FALSE
348.7491FALSE
348.7511FALSE
348.7494FALSE
348.7516FALSE
348.7488FALSE
348.7508FALSE
348.7487FALSE
348.7475FALSE
348.7487FALSE
348.7475FALSE
348.7487FALSE
348.7475FALSE
348.7488FALSE
348.7474FALSE
348.7487FALSE
348.7475FALSE
348.7483FALSE
348.7497FALSE
348.7483FALSE
348.7496FALSE
348.7483FALSE
348.7497FALSE
348.7484FALSE
348.75FALSE
348.7483FALSE
348.7494FALSE
348.7476FALSE
348.7474FALSE
348.7476FALSE
348.7474FALSE
348.7476FALSE
348.7474FALSE
348.7477FALSE
348.7475FALSE
348.7477FALSE
348.7475FALSE
348.7474FALSE
348.7474FALSE
348.7474FALSE
348.7474FALSE
348.7474FALSE
348.7474FALSE
348.7474FALSE
348.7474FALSE
348.7474FALSE
348.7474FALSE
348.7473FALSE
348.7471FALSE
348.7473FALSE
348.7471FALSE
348.7473FALSE
348.7471FALSE
348.7473FALSE
348.7474FALSE
348.7473FALSE
348.7472FALSE
348.7472FALSE
348.7472FALSE
348.7472FALSE
348.7472FALSE
348.7472FALSE
348.7472FALSE
348.7473FALSE
348.7472FALSE
348.7472FALSE
348.7472FALSE
348.7476FALSE
348.7471FALSE
348.7476FALSE
348.7471FALSE
348.7476FALSE
348.7471FALSE
348.7475FALSE
348.7474FALSE
348.7472FALSE
348.7477FALSE
348.7471FALSE
348.7472FALSE
348.7471FALSE
348.7472FALSE
348.7471FALSE
348.7472FALSE
348.7474FALSE
348.7472FALSE
348.7472FALSE
348.7473FALSE
348.7471FALSE
348.7472FALSE
348.7471FALSE
348.7472FALSE
348.7471FALSE
348.7472FALSE
348.7474FALSE
348.7472FALSE
348.7472FALSE
348.7473FALSE
348.7472FALSE
348.7471FALSE
348.7472FALSE
348.7471FALSE
348.7472FALSE
348.7471FALSE
348.7473FALSE
348.7474FALSE
348.7472FALSE
348.7472FALSE
348.7472FALSE
348.7471FALSE
348.7472FALSE
348.7471FALSE
348.7472FALSE
348.7471FALSE
348.7473FALSE
348.7474FALSE
348.7472FALSE
348.7472FALSE
348.7471FALSE
348.7472FALSE
348.7471FALSE
348.7472FALSE
348.7471FALSE
348.7472FALSE
348.7474FALSE
348.7473FALSE
348.7472FALSE
348.7472FALSE
348.7471FALSE
348.7472FALSE
348.7471FALSE
348.7472FALSE
348.7471FALSE
348.7472FALSE
348.7474FALSE
348.7473FALSE
348.7472FALSE
348.7472FALSE
348.7472FALSE
348.7471FALSE
348.7472FALSE
348.7471FALSE
348.7472FALSE
348.7471FALSE
348.7473FALSE
348.7474FALSE
348.7472FALSE
348.7472FALSE
348.7472FALSE
348.7471FALSE
348.7472FALSE
348.7471FALSE
348.7472FALSE
348.7471FALSE
348.7473FALSE
348.7474FALSE
348.7472FALSE
348.7472FALSE
348.7472FALSE
348.7471FALSE
348.7472FALSE
348.7471FALSE
348.7472FALSE
348.7471FALSE
348.7473FALSE
348.7474FALSE
348.7472FALSE
348.7472FALSE
348.7472FALSE
348.7471FALSE
348.7472FALSE
348.7471FALSE
348.7472FALSE
348.7471FALSE
348.7473FALSE
348.7474FALSE
348.7472FALSE
348.7472FALSE
348.7472FALSE
348.7472FALSE
348.7471FALSE
348.7472FALSE
348.7471FALSE
348.7473FALSE
348.7471FALSE
348.7472FALSE
348.7474FALSE
348.7472FALSE
348.7472FALSE
348.7472FALSE
348.7471FALSE
348.7472FALSE
348.7471FALSE
348.7473FALSE
348.7471FALSE
348.7472FALSE
348.7474FALSE
348.7472FALSE
348.7472FALSE
348.7472FALSE
348.7471FALSE
348.7472FALSE
348.7471FALSE
348.7473FALSE
348.7471FALSE
348.7472FALSE
348.7474FALSE
348.7472FALSE
348.7472FALSE
348.7472FALSE
348.7471FALSE
348.7472FALSE
348.7471FALSE
348.7473FALSE
348.7471FALSE
348.7472FALSE
348.7474FALSE
348.7472FALSE
348.7472FALSE
348.7472FALSE
348.7471FALSE
348.7472FALSE
348.7471FALSE
348.7473FALSE
348.7471FALSE
348.7472FALSE
348.7474FALSE
348.7472FALSE
348.7472FALSE
348.7472FALSE
348.7472FALSE
348.7471FALSE
348.7473FALSE
348.7471FALSE
348.7472FALSE
348.7471FALSE
348.7472FALSE
348.7474FALSE
348.7472FALSE
348.7472FALSE
348.7472FALSE
348.7471FALSE
348.7473FALSE
348.7471FALSE
348.7472FALSE
$par
smooth_log_cases_lag1.bw         time_ind_lag0.bw 
                4.915827                -1.579456 

$value
[1] 348.7472

$counts
function gradient 
      43       43 

$convergence
[1] 0

$message
[1] "CONVERGENCE: REL_REDUCTION_OF_F <= FACTR*EPSMCH"

348.7471FALSE
348.7474FALSE
348.7472FALSE
348.7471FALSE
348.7471FALSE
348.7471FALSE
348.7474FALSE
348.7472FALSE
348.9626FALSE
348.9626FALSE
348.9626FALSE
348.9592FALSE
348.9659FALSE
348.7473FALSE
348.7473FALSE
348.7473FALSE
348.7472FALSE
348.7473FALSE
348.7472FALSE
348.7472FALSE
348.7472FALSE
348.7473FALSE
348.7472FALSE
348.7471FALSE
348.7471FALSE
348.7471FALSE
348.7474FALSE
348.7472FALSE
348.7471FALSE
348.7471FALSE
348.7471FALSE
348.7474FALSE
348.7472FALSE
348.7471FALSE
348.7471FALSE
348.7471FALSE
348.7474FALSE
348.7472FALSE
348.7471FALSE
348.7471FALSE
348.7471FALSE
348.7474FALSE
348.7472FALSE
348.7471FALSE
348.7471FALSE
348.7471FALSE
348.7474FALSE
348.7472FALSE
348.7471FALSE
348.7471FALSE
348.7471FALSE
348.7474FALSE
348.7472FALSE
348.7471FALSE
348.7471FALSE
348.7471FALSE
348.7474FALSE
348.7472FALSE
348.7471FALSE
348.7471FALSE
348.7471FALSE
348.7474FALSE
348.7472FALSE
348.7471FALSE
348.7471FALSE
348.7471FALSE
348.7474FALSE
348.7472FALSE
348.7471FALSE
348.7471FALSE
348.7471FALSE
348.7474FALSE
348.7472FALSE
348.7471FALSE
348.7471FALSE
348.7471FALSE
348.7474FALSE
348.7472FALSE
348.7471FALSE
348.7471FALSE
348.7471FALSE
348.7474FALSE
348.7472FALSE
348.7471FALSE
348.7471FALSE
348.7471FALSE
348.7474FALSE
348.7472FALSE
348.7471FALSE
348.7471FALSE
348.7471FALSE
348.7474FALSE
348.7472FALSE
348.7471FALSE
348.7471FALSE
348.7471FALSE
348.7474FALSE
348.7472FALSE
348.7471FALSE
348.7471FALSE
348.7471FALSE
348.7474FALSE
348.7472FALSE
348.7471FALSE
348.7471FALSE
348.7471FALSE
348.7474FALSE
348.7472FALSE
$par
smooth_log_cases_lag0.bw         time_ind_lag0.bw 
                5.075757                -1.578801 

$value
[1] 348.7471

$counts
function gradient 
      64       64 

$convergence
[1] 52

$message
[1] "ERROR: ABNORMAL_TERMINATION_IN_LNSRCH"

> 
> save(ssr_fit,
+     file=paste0("/home/ngr67a/2015-cdc-flu-competition/fit-competition-ssr-ph", prediction_horizon_limit, "-", data_set, ".Rdata"))
> 
> proc.time()
    user   system  elapsed 
1133.479    0.810 1214.991 
