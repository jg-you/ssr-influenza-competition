
R version 3.2.2 (2015-08-14) -- "Fire Safety"
Copyright (C) 2015 The R Foundation for Statistical Computing
Platform: x86_64-pc-linux-gnu (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

  Natural language support but running in an English locale

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> ### get ssr fit -- prediction horizons 1:52
> library(lubridate)
> library(ggplot2)
> library(plyr)

Attaching package: ‘plyr’

The following object is masked from ‘package:lubridate’:

    here

> library(dplyr)

Attaching package: ‘dplyr’

The following objects are masked from ‘package:plyr’:

    arrange, count, desc, failwith, id, mutate, rename, summarise,
    summarize

The following objects are masked from ‘package:lubridate’:

    intersect, setdiff, union

The following objects are masked from ‘package:stats’:

    filter, lag

The following objects are masked from ‘package:base’:

    intersect, setdiff, setequal, union

> library(reshape)

Attaching package: ‘reshape’

The following object is masked from ‘package:dplyr’:

    rename

The following objects are masked from ‘package:plyr’:

    rename, round_any

The following object is masked from ‘package:lubridate’:

    stamp

> library(ssrFlu)
> library(doMC)
Loading required package: foreach
Loading required package: iterators
Loading required package: parallel
> 
> registerDoMC(cores=3)
> 
> args <- commandArgs(trailingOnly=TRUE)
> 
> data_set <- args[1]
> prediction_horizon_limit <- as.integer(args[2])
> 
> ## load dataset
> if(identical(data_set, "ili_national")) {
+     data <- ili_national
+ } 
> if(identical(data_set, "ili_region1")) {
+     data <- ili_region1
+ } 
> if(identical(data_set, "ili_region2")) {
+     data <- ili_region2
+ } 
> if(identical(data_set, "ili_region3")) {
+     data <- ili_region3
+ } 
> if(identical(data_set, "ili_region4")) {
+     data <- ili_region4
+ } 
> if(identical(data_set, "ili_region5")) {
+     data <- ili_region5
+ } 
> if(identical(data_set, "ili_region6")) {
+     data <- ili_region6
+ } 
> if(identical(data_set, "ili_region7")) {
+     data <- ili_region7
+ } 
> if(identical(data_set, "ili_region8")) {
+     data <- ili_region8
+ } 
> if(identical(data_set, "ili_region9")) {
+     data <- ili_region9
+ } 
> if(identical(data_set, "ili_region10")) {
+     data <- ili_region10
+ } 
> 
> 
> 
> ## add log column
> data$log_total_cases <- log(data$total_cases + 1)
> 
> ## add week_start_date
> char_dates <- paste(data$year, data$week, "1")
> data$week_start_date <- as.Date(char_dates, format="%Y %W %w")
> 
> ## remove week 53s
> data <- data[-which(is.na(data$week_start_date)),]
> data <- data[262:nrow(data),]
> 
> ## add smooth log column -- or not, since it is already pretty smooth...
> sm <- loess(log_total_cases ~ as.numeric(week_start_date), data=data, span= 26 / nrow(data))
> data$smooth_log_cases <- sm$fitted
> 
> ## add time column
> data$time_ind <- seq_len(nrow(data))
> 
> ssr_control <- create_ssr_control(X_names=c("smooth_log_cases", "time_ind"),
+     y_names="total_cases",
+     time_name=NULL,
+     max_lag=list(smooth_log_cases=1,
+         time_ind=0),
+     prediction_horizons=as.integer(prediction_horizon_limit),
+     kernel_fns=list(smooth_log_cases="squared_exp_kernel",
+         time_ind="periodic_kernel"),
+     theta_est=list(smooth_log_cases="bw",
+         time_ind="bw"),
+     theta_fixed=list(time_ind=list(period=pi / 52)),
+     theta_transform_fns=list(
+         squared_exp_kernel=list(
+             bw=list(transform="log",
+                 detransform="exp")
+         ),
+         periodic_kernel=list(
+             bw=list(transform="log",
+                 detransform="exp")
+         )
+     ),
+     crossval_buffer=52,
+     loss_fn_name="mae_from_kernel_weights_and_centers",
+     loss_fn_args=list())
> 
> 
> ssr_fit <- ssr(X_names=c("smooth_log_cases", "time_ind"),
+     y_names="total_cases",
+     time_name=NULL,
+     data=data,
+     ssr_control=ssr_control)
538.4099FALSE
546.0341FALSE
387.9326FALSE
538.4048FALSE
546.028FALSE
387.931FALSE
538.4149FALSE
546.0402FALSE
387.9342FALSE
538.6441FALSE
546.6576FALSE
395.8437FALSE
538.6523FALSE
546.6644FALSE
395.8729FALSE
538.636FALSE
546.6508FALSE
395.8145FALSE
537.3956FALSE
544.9359FALSE
387.7828FALSE
537.3958FALSE
544.9373FALSE
387.7834FALSE
537.3953FALSE
544.9345FALSE
387.7824FALSE
537.3928FALSE
544.9102FALSE
387.7885FALSE
544.9101FALSE
537.3929FALSE
387.7883FALSE
544.9103FALSE
537.3926FALSE
387.7887FALSE
544.9116FALSE
537.4072FALSE
387.7815FALSE
544.9119FALSE
387.7816FALSE
537.4067FALSE
544.9113FALSE
387.7814FALSE
537.4076FALSE
544.9101FALSE
387.7816FALSE
537.3922FALSE
544.9099FALSE
387.7814FALSE
537.3924FALSE
544.9102FALSE
387.7819FALSE
537.392FALSE
544.91FALSE
387.7814FALSE
537.3924FALSE
544.9101FALSE
387.7815FALSE
537.3921FALSE
544.9101FALSE
387.7815FALSE
537.3927FALSE
544.91FALSE
387.7814FALSE
537.392FALSE
544.9101FALSE
387.7815FALSE
544.9101FALSE
537.3922FALSE
387.7815FALSE
544.91FALSE
387.7814FALSE
537.3921FALSE
544.9101FALSE
387.7815FALSE
537.3922FALSE
544.9101FALSE
387.7815FALSE
537.392FALSE
544.91FALSE
537.3925FALSE
387.7814FALSE
544.9101FALSE
387.7815FALSE
544.9101FALSE
537.392FALSE
387.7815FALSE
544.91FALSE
537.3922FALSE
387.7814FALSE
544.9101FALSE
537.3921FALSE
387.7815FALSE
544.9101FALSE
537.392FALSE
387.7815FALSE
544.91FALSE
537.3922FALSE
387.7814FALSE
544.9101FALSE
537.3922FALSE
387.7815FALSE
544.9101FALSE
537.392FALSE
387.7815FALSE
544.91FALSE
537.3922FALSE
387.7814FALSE
544.9101FALSE
537.3922FALSE
$par
smooth_log_cases_lag0.bw 
               -1.827958 

$value
[1] 537.392

$counts
function gradient 
      12       12 

$convergence
[1] 0

$message
[1] "CONVERGENCE: REL_REDUCTION_OF_F <= FACTR*EPSMCH"

387.7815FALSE
544.9101FALSE
387.7815FALSE
544.91FALSE
387.7814FALSE
544.9101FALSE
387.7815FALSE
544.9101FALSE
387.7815FALSE
544.91FALSE
544.9101FALSE
387.7814FALSE
544.9101FALSE
387.7815FALSE
544.91FALSE
387.7815FALSE
544.9101FALSE
387.7814FALSE
544.9101FALSE
387.7815FALSE
544.91FALSE
387.7815FALSE
544.9101FALSE
387.7814FALSE
544.9101FALSE
387.7815FALSE
544.91FALSE
387.7815FALSE
544.9101FALSE
544.9101FALSE
$par
smooth_log_cases_lag1.bw 
               -1.939529 

$value
[1] 544.91

$counts
function gradient 
      18       18 

$convergence
[1] 0

$message
[1] "CONVERGENCE: REL_REDUCTION_OF_F <= FACTR*EPSMCH"

387.7814FALSE
387.7815FALSE
387.7815FALSE
387.7814FALSE
387.7815FALSE
387.7815FALSE
387.7814FALSE
387.7815FALSE
387.7815FALSE
387.7814FALSE
387.7815FALSE
387.7815FALSE
387.7814FALSE
387.7815FALSE
387.7815FALSE
387.7814FALSE
387.7815FALSE
387.7815FALSE
387.7814FALSE
387.7815FALSE
387.7815FALSE
$par
time_ind_lag0.bw 
       -2.127588 

$value
[1] 387.7814

$counts
function gradient 
      24       24 

$convergence
[1] 0

$message
[1] "CONVERGENCE: REL_REDUCTION_OF_F <= FACTR*EPSMCH"

411.8048FALSE
410.2413FALSE
411.798FALSE
411.8115FALSE
410.2371FALSE
411.8146FALSE
411.7949FALSE
410.2454FALSE
399.7177FALSE
399.7046FALSE
410.2503FALSE
399.7307FALSE
399.7175FALSE
410.2322FALSE
399.7178FALSE
401.3384FALSE
394.6111FALSE
394.6112FALSE
401.3242FALSE
394.6111FALSE
394.6111FALSE
401.3526FALSE
394.6111FALSE
394.611FALSE
401.3375FALSE
394.611FALSE
401.3393FALSE
394.611FALSE
394.611FALSE
394.3585FALSE
394.611FALSE
394.3588FALSE
394.6103FALSE
394.3583FALSE
394.6104FALSE
394.3585FALSE
394.6103FALSE
394.3585FALSE
394.6103FALSE
394.3502FALSE
394.6103FALSE
394.3504FALSE
394.6075FALSE
394.3499FALSE
394.6075FALSE
394.3502FALSE
394.6075FALSE
394.3502FALSE
394.6075FALSE
394.3131FALSE
394.6075FALSE
394.5904FALSE
394.3134FALSE
394.5904FALSE
394.3128FALSE
394.5903FALSE
394.3131FALSE
394.5904FALSE
394.3131FALSE
394.5904FALSE
394.6987FALSE
394.174FALSE
394.6963FALSE
394.1713FALSE
394.7011FALSE
394.1767FALSE
394.6987FALSE
394.1697FALSE
394.6987FALSE
394.1783FALSE
394.2907FALSE
653.2457FALSE
394.2907FALSE
653.1984FALSE
394.2906FALSE
653.2928FALSE
394.2907FALSE
653.2466FALSE
394.2907FALSE
653.2448FALSE
394.2836FALSE
394.1318FALSE
394.2836FALSE
394.1285FALSE
394.2835FALSE
394.1351FALSE
394.2836FALSE
394.1273FALSE
394.2836FALSE
394.1363FALSE
394.8837FALSE
394.1159FALSE
394.8802FALSE
394.1124FALSE
394.8872FALSE
394.1193FALSE
394.8837FALSE
394.1111FALSE
394.8837FALSE
394.1206FALSE
394.2827FALSE
438.7918FALSE
394.2827FALSE
438.7902FALSE
394.2828FALSE
438.7933FALSE
394.2827FALSE
438.8516FALSE
394.2827FALSE
438.732FALSE
394.283FALSE
395.6061FALSE
394.2831FALSE
395.5956FALSE
394.2829FALSE
395.6166FALSE
394.283FALSE
395.6019FALSE
395.6103FALSE
394.283FALSE
394.1047FALSE
394.2827FALSE
394.1002FALSE
394.2827FALSE
394.1091FALSE
394.2828FALSE
394.0999FALSE
394.2827FALSE
394.1094FALSE
394.2827FALSE
394.2868FALSE
394.1047FALSE
394.2869FALSE
394.1002FALSE
394.2868FALSE
394.2868FALSE
394.1091FALSE
394.0999FALSE
394.2868FALSE
394.1094FALSE
394.2832FALSE
394.5878FALSE
394.2832FALSE
394.5879FALSE
394.2831FALSE
394.2832FALSE
394.5878FALSE
394.2832FALSE
394.5878FALSE
394.2827FALSE
394.5878FALSE
394.2828FALSE
394.2667FALSE
394.2827FALSE
394.2827FALSE
394.2643FALSE
394.2827FALSE
394.2826FALSE
394.269FALSE
394.2827FALSE
394.2828FALSE
394.2621FALSE
394.2826FALSE
394.2826FALSE
394.2712FALSE
394.2827FALSE
394.1023FALSE
394.2827FALSE
394.0979FALSE
394.2827FALSE
394.1066FALSE
394.2827FALSE
394.0976FALSE
394.2827FALSE
394.1069FALSE
394.2826FALSE
394.1784FALSE
394.2827FALSE
394.2828FALSE
394.1758FALSE
394.2826FALSE
394.1811FALSE
394.2826FALSE
394.1742FALSE
394.2827FALSE
394.1826FALSE
394.2827FALSE
394.1012FALSE
394.2828FALSE
394.0969FALSE
394.2827FALSE
394.1054FALSE
394.2827FALSE
394.0963FALSE
394.2826FALSE
394.106FALSE
394.2827FALSE
392.2934FALSE
394.2828FALSE
392.2909FALSE
394.2826FALSE
392.296FALSE
394.2826FALSE
392.2883FALSE
394.2826FALSE
392.2986FALSE
394.2827FALSE
388.7794FALSE
394.2828FALSE
388.7778FALSE
394.2826FALSE
388.781FALSE
394.2826FALSE
388.7791FALSE
394.2826FALSE
388.7797FALSE
394.2827FALSE
388.4224FALSE
394.2828FALSE
388.4212FALSE
394.2826FALSE
388.4236FALSE
394.2826FALSE
$par
smooth_log_cases_lag1.bw         time_ind_lag0.bw 
              -0.5054047               -4.8123956 

$value
[1] 394.2826

$counts
function gradient 
      22       22 

$convergence
[1] 0

$message
[1] "CONVERGENCE: REL_REDUCTION_OF_F <= FACTR*EPSMCH"

388.4229FALSE
388.4219FALSE
388.0737FALSE
388.0731FALSE
388.0742FALSE
388.0736FALSE
388.0738FALSE
388.0665FALSE
388.0662FALSE
388.0667FALSE
388.0682FALSE
388.0648FALSE
387.8896FALSE
387.8894FALSE
387.8898FALSE
387.8905FALSE
387.8887FALSE
387.8449FALSE
387.8448FALSE
387.845FALSE
387.8446FALSE
387.8452FALSE
387.8283FALSE
387.8283FALSE
387.8284FALSE
387.828FALSE
387.8287FALSE
388.025FALSE
388.0249FALSE
388.025FALSE
388.0268FALSE
388.0231FALSE
387.8071FALSE
387.807FALSE
387.8071FALSE
387.8068FALSE
387.8073FALSE
387.884FALSE
387.884FALSE
387.884FALSE
387.8854FALSE
387.8826FALSE
387.8066FALSE
387.8066FALSE
387.8067FALSE
387.8072FALSE
387.8061FALSE
387.7996FALSE
387.7995FALSE
387.7996FALSE
387.7997FALSE
387.7995FALSE
387.7914FALSE
387.7913FALSE
387.7914FALSE
387.7915FALSE
387.7913FALSE
387.7898FALSE
387.7898FALSE
387.7898FALSE
387.7896FALSE
387.7901FALSE
387.7882FALSE
387.7882FALSE
387.7882FALSE
387.7879FALSE
387.7884FALSE
387.7841FALSE
387.7841FALSE
387.7841FALSE
387.7842FALSE
387.7841FALSE
387.7833FALSE
387.7833FALSE
387.7833FALSE
387.7834FALSE
387.7832FALSE
387.7856FALSE
387.7856FALSE
387.7856FALSE
387.7854FALSE
387.7859FALSE
387.7826FALSE
387.7826FALSE
387.7826FALSE
387.7827FALSE
387.7828FALSE
387.7821FALSE
387.7821FALSE
387.7821FALSE
387.7822FALSE
387.7823FALSE
387.7819FALSE
387.7819FALSE
387.7819FALSE
387.7819FALSE
387.7818FALSE
387.7815FALSE
387.7815FALSE
387.7815FALSE
387.7816FALSE
387.7818FALSE
387.7815FALSE
387.7815FALSE
387.7815FALSE
387.7816FALSE
387.7815FALSE
387.7815FALSE
387.7815FALSE
387.7815FALSE
387.7816FALSE
387.7817FALSE
387.7815FALSE
387.7815FALSE
387.7815FALSE
387.7816FALSE
387.7817FALSE
387.7815FALSE
387.7815FALSE
387.7815FALSE
387.7816FALSE
387.7818FALSE
387.7815FALSE
387.7815FALSE
387.7815FALSE
387.7816FALSE
387.7818FALSE
387.7815FALSE
387.7815FALSE
387.7815FALSE
387.7816FALSE
387.7818FALSE
387.7815FALSE
387.7815FALSE
387.7815FALSE
387.7816FALSE
387.7818FALSE
387.7815FALSE
387.7815FALSE
387.7815FALSE
387.7816FALSE
387.7818FALSE
387.7815FALSE
387.7815FALSE
387.7815FALSE
387.7816FALSE
387.7818FALSE
387.7815FALSE
387.7815FALSE
387.7815FALSE
387.7816FALSE
387.7818FALSE
387.7815FALSE
387.7815FALSE
387.7815FALSE
387.7816FALSE
387.7818FALSE
387.7815FALSE
387.7815FALSE
387.7815FALSE
387.7816FALSE
387.7818FALSE
387.7815FALSE
387.7815FALSE
387.7815FALSE
387.7816FALSE
387.7818FALSE
387.7815FALSE
387.7815FALSE
387.7815FALSE
387.7816FALSE
387.7818FALSE
387.7815FALSE
387.7815FALSE
387.7815FALSE
387.7816FALSE
387.7818FALSE
387.7815FALSE
387.7815FALSE
387.7815FALSE
387.7816FALSE
387.7818FALSE
387.7815FALSE
387.7815FALSE
387.7815FALSE
387.7816FALSE
387.7818FALSE
387.7815FALSE
387.7815FALSE
387.7815FALSE
387.7816FALSE
387.7818FALSE
$par
smooth_log_cases_lag0.bw         time_ind_lag0.bw 
                4.191809                -2.128048 

$value
[1] 387.7815

$counts
function gradient 
      61       61 

$convergence
[1] 0

$message
[1] "CONVERGENCE: REL_REDUCTION_OF_F <= FACTR*EPSMCH"

> 
> save(ssr_fit,
+     file=paste0("/home/ngr67a/2015-cdc-flu-competition/fit-competition-ssr-ph", prediction_horizon_limit, "-", data_set, ".Rdata"))
> 
> proc.time()
    user   system  elapsed 
 528.619    0.453 1056.118 
